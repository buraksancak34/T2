<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360¬∞ Canlƒ± G√∂r√º≈üme Analiz Portalƒ±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            border-color: rgba(99, 102, 241, 0.4);
            background: rgba(30, 41, 59, 0.8);
        }

        .admin-sidebar {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -15px 0 35px rgba(0, 0, 0, 0.5);
            z-index: 999999;
        }

        .custom-input {
            background: #1e293b !important;
            border: 1px solid #334155 !important;
            color: white !important;
            padding: 10px !important;
            border-radius: 8px !important;
            width: 100% !important;
            font-size: 14px !important;
        }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 500px; 
            margin: auto;
            height: 350px;
        }

        #status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        @keyframes pulse-custom {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .sync-pulse { animation: pulse-custom 2s infinite; }
    </style>

    <!-- Chosen Palette: Midnight Lavender (Slate 900 base, Indigo 500 accents) -->
    <!-- Application Structure Plan: 
         - A real-time synchronized dashboard using Firebase Firestore for data persistence and GitHub Pages for static hosting.
         - Flow: Summary KPIs (Top) -> Radar Analysis for network balance (Left) -> Individual progress cards (Right).
         - Information Architecture: Designed to prioritize coverage visualization through a radar chart and granular status via cards.
    -->
    <!-- Visualization & Content Choices:
         - Radar Chart: Ideal for showing the 'balance' of the strategy across different sectors.
         - Cards: Provide a human-centric view of progress using emoji tallies.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="min-h-screen antialiased">

    <!-- Baƒülantƒ± Durum G√∂stergesi -->
    <div id="status-indicator">
        <div id="status-chip" class="bg-slate-800 text-slate-500 px-3 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest border border-slate-700">
            Baƒülantƒ± Kuruluyor...
        </div>
    </div>

    <!-- Veri D√ºzenleme Paneli (Sidebar) -->
    <div id="admin-panel" class="fixed top-0 right-0 h-full w-80 bg-slate-900 border-l border-slate-700 p-6 admin-sidebar translate-x-full">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold flex items-center text-white m-0">
                <span class="mr-2">‚öôÔ∏è</span> Verileri Y√∂net
            </h2>
            <button onclick="toggleAdmin()" class="text-slate-400 hover:text-white text-2xl border-none bg-transparent cursor-pointer">&times;</button>
        </div>
        
        <div id="editor-list" class="space-y-6 overflow-y-auto max-h-[calc(100vh-220px)] pr-2 custom-scroll text-white text-left">
            <!-- JavaScript dynamically populates this -->
        </div>

        <div class="mt-6 pt-6 border-t border-slate-700 space-y-3 text-left">
            <button onclick="addNewCategory()" class="w-full py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-bold text-white transition-all cursor-pointer border-none shadow-lg">
                + Yeni Kategori Ekle
            </button>
            <button onclick="resetData()" class="w-full py-2 border border-slate-700 hover:bg-slate-800 rounded-lg text-xs text-slate-400 transition-all cursor-pointer">
                Verileri Sƒ±fƒ±rla
            </button>
        </div>
    </div>

    <div class="p-4 md:p-10 max-w-7xl mx-auto">
        <header class="text-center mb-12 relative">
            <div class="absolute top-0 right-0 z-10 hidden md:block">
                <button onclick="toggleAdmin()" class="bg-indigo-600/20 text-indigo-400 border border-indigo-500/30 px-6 py-2.5 rounded-full text-xs font-bold hover:bg-indigo-600 hover:text-white transition-all shadow-lg cursor-pointer">
                    üõ†Ô∏è Verileri D√ºzenle
                </button>
            </div>
            <h1 class="text-3xl md:text-5xl font-black text-white mb-4 tracking-tighter m-0 uppercase">
                360¬∞ G√∂r√º≈üme Takibi
            </h1>
            <p class="text-slate-400 text-lg m-0 text-center w-full">Canlƒ± Bulut Senkronizasyonu</p>
            
            <div class="mt-8 flex flex-wrap justify-center gap-4">
                <button id="view-toggle-btn" onclick="toggleView()" class="bg-slate-800 text-white border border-slate-700 px-8 py-3 rounded-2xl font-bold hover:bg-slate-700 transition-all cursor-pointer">
                    Tablo G√∂r√ºn√ºm√ºne Ge√ß
                </button>
                <button onclick="toggleAdmin()" class="md:hidden bg-indigo-600 text-white px-8 py-3 rounded-2xl font-bold transition-all shadow-lg cursor-pointer">
                    üõ†Ô∏è Verileri D√ºzenle
                </button>
            </div>
        </header>

        <!-- KPI Summary Section -->
        <div id="stats-summary" class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-10">
            <!-- JavaScript dynamically populates this -->
        </div>

        <!-- Dashboard Analysis Area -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
            <!-- Radar Chart Area (Left) -->
            <div class="lg:col-span-5 glass-card p-8 rounded-3xl flex flex-col items-center">
                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-6">Aƒü Dengesi Analizi</h3>
                <div class="chart-container">
                    <canvas id="radarChart"></canvas>
                </div>
                <p class="text-[10px] text-slate-500 mt-6 text-center italic">Radar grafik, t√ºm kategorilerdeki ilerleme dengesini g√∂sterir.</p>
            </div>

            <!-- Cards/Table Area (Right) -->
            <div class="lg:col-span-7">
                <div id="card-view" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                
                <div id="table-view" class="hidden glass-card rounded-3xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse min-w-[600px]">
                            <thead class="bg-slate-800/40 text-slate-500 uppercase text-[10px] font-bold tracking-widest">
                                <tr>
                                    <th class="px-6 py-5 text-left">Kategori</th>
                                    <th class="px-6 py-5 text-center">Hedef</th>
                                    <th class="px-6 py-5 text-center">Biten</th>
                                    <th class="px-6 py-5 text-right">Ba≈üarƒ±</th>
                                </tr>
                            </thead>
                            <tbody id="table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Entegrasyonu -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, updateDoc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- Sƒ∞Zƒ∞N √ñZEL YAPILANDIRMANIZ ---
        const myFirebaseConfig = {
            apiKey: "AIzaSyCbIuOJeKNpJToMg2-PsblLtue-mzElUQY",
            authDomain: "tezz-95f0d.firebaseapp.com",
            projectId: "tezz-95f0d",
            storageBucket: "tezz-95f0d.firebasestorage.app",
            messagingSenderId: "87135277271",
            appId: "1:87135277271:web:49cc5d5ee7b473bfa7a092",
            measurementId: "G-D2WLJXGP67"
        };

        const firebaseConfigRaw = (typeof __firebase_config !== 'undefined' && __firebase_config) ? JSON.parse(__firebase_config) : myFirebaseConfig;
        const appId = (typeof __app_id !== 'undefined') ? __app_id : 'gorusme-takip-v4';

        let db, auth;
        let data = [];
        let radarChart = null;
        let currentView = 'card';

        const startApp = async () => {
            const app = initializeApp(firebaseConfigRaw);
            db = getFirestore(app);
            auth = getAuth(app);

            try {
                // RULE 3: Auth Before Queries
                await signInAnonymously(auth);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        renderOnlineStatus();
                        setupDataListener();
                    }
                });
            } catch (err) {
                renderOfflineStatus();
                useLocalData();
            }
        };

        const setupDataListener = () => {
            // RULE 1: Strict Paths
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'gorusmeler');
            onSnapshot(colRef, (snapshot) => {
                if (snapshot.empty) {
                    seedData();
                    return;
                }
                data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                data.sort((a, b) => (a.order || 0) - (b.order || 0));
                render(); renderEditor(); updateRadar();
            }, (error) => {
                console.error("Firebase listen error:", error);
            });
        };

        const seedData = async () => {
            const initial = [
                { title: 'Hocalar', completed: 11, total: 11, emoji: 'üë®‚Äçüè´', order: 1 },
                { title: 'STK (Sivil Toplum)', completed: 5, total: 6, emoji: 'üå≥', order: 2 },
                { title: 'B√ºrokratlar', completed: 4, total: 4, emoji: 'üèõÔ∏è', order: 3 },
                { title: 'Siyasi Partiler', completed: 2, total: 6, emoji: 'üíº', order: 4 },
                { title: 'Enerji Sekt√∂r√º', completed: 1, total: 4, emoji: '‚ö°', order: 5 },
                { title: 'Gazeteciler', completed: 0, total: 2, emoji: 'üé§', order: 6 }
            ];
            for (const item of initial) {
                const docId = item.title.toLowerCase().replace(/[^a-z0-9]/g, '-');
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'gorusmeler', docId), item);
            }
        };

        // --- GLOBAL ACTIONS ---
        window.toggleAdmin = () => document.getElementById('admin-panel').classList.toggle('translate-x-full');
        
        window.updateValue = async (id, field, value) => {
            let val = (field === 'completed' || field === 'total') ? parseInt(value) || 0 : value;
            if (db && auth.currentUser) {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'gorusmeler', id);
                await updateDoc(docRef, { [field]: val });
            } else {
                const idx = data.findIndex(d => d.id === id);
                if (idx !== -1) { data[idx][field] = val; render(); updateRadar(); }
            }
        };

        window.addNewCategory = async () => {
            const id = `cat-${Date.now()}`;
            const newCat = { title: 'Yeni Kategori', completed: 0, total: 5, emoji: 'üë§', order: data.length + 1 };
            if (db && auth.currentUser) {
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'gorusmeler', id), newCat);
            } else {
                data.push({ id, ...newCat }); render(); renderEditor(); updateRadar();
            }
        };

        window.removeCategory = async (id) => {
            if (!confirm('Silmek istediƒüinize emin misiniz?')) return;
            if (db && auth.currentUser) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'gorusmeler', id));
            } else {
                data = data.filter(d => d.id !== id); render(); renderEditor(); updateRadar();
            }
        };

        window.resetData = async () => {
            if (!confirm('T√ºm veriler varsayƒ±lan haline d√∂necektir. Emin misiniz?')) return;
            if (db && auth.currentUser) {
                const snap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'gorusmeler'));
                for (const d of snap.docs) await deleteDoc(d.ref);
                seedData();
            }
        };

        window.toggleView = () => {
            const cv = document.getElementById('card-view');
            const tv = document.getElementById('table-view');
            const btn = document.getElementById('view-toggle-btn');
            currentView = (currentView === 'card' ? 'table' : 'card');
            cv.classList.toggle('hidden', currentView !== 'card');
            tv.classList.toggle('hidden', currentView !== 'table');
            btn.innerText = currentView === 'card' ? "Tablo G√∂r√ºn√ºm√ºne Ge√ß" : "Kart G√∂r√ºn√ºm√ºne Ge√ß";
        };

        // --- STATUS RENDERS ---
        function renderOnlineStatus() {
            const chip = document.getElementById('status-chip');
            chip.innerText = "Canlƒ± Bulut Baƒülantƒ±sƒ±";
            chip.className = "bg-emerald-600/20 text-emerald-400 px-3 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest border border-emerald-500/30 sync-pulse";
        }
        function renderOfflineStatus() {
            const chip = document.getElementById('status-chip');
            chip.innerText = "Yerel Mod (Kaydedilmez)";
            chip.className = "bg-rose-600/20 text-rose-400 px-3 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest border border-rose-500/30";
        }

        // --- DASHBOARD RENDERERS ---
        function render() {
            const cards = document.getElementById('card-view');
            const table = document.getElementById('table-body');
            const summary = document.getElementById('stats-summary');
            if(!cards || !table || !summary) return;
            
            cards.innerHTML = ''; table.innerHTML = '';
            let tDone = 0, tTarget = 0;

            data.forEach(item => {
                const perc = item.total > 0 ? Math.round((item.completed/item.total)*100) : 0;
                tDone += item.completed; tTarget += item.total;
                
                const card = document.createElement('div');
                card.className = 'glass-card rounded-3xl p-6 text-left';
                let icons = '';
                for(let i=0; i<item.total; i++) icons += `<span class="text-2xl inline-block mb-1 ${i < item.completed ? '' : 'opacity-10 grayscale'}">${item.emoji}</span>`;
                card.innerHTML = `<div class="flex justify-between items-start mb-4 text-white"><div class="text-left"><h3 class="font-bold text-sm m-0">${item.title}</h3><p class="text-[10px] opacity-40 uppercase font-bold m-0 mt-1">${item.completed}/${item.total}</p></div><span class="text-2xl font-black text-indigo-400">${perc}%</span></div><div class="flex flex-wrap gap-1 mb-6 min-h-[40px]">${icons}</div><div class="h-1 bg-slate-800 rounded-full overflow-hidden shadow-inner"><div class="h-full bg-indigo-500 transition-all duration-1000" style="width:${perc}%"></div></div>`;
                cards.appendChild(card);

                const row = document.createElement('tr');
                row.className = 'border-b border-slate-800/50 text-white';
                row.innerHTML = `<td class="px-6 py-4 font-bold text-xs text-left">${item.title}</td><td class="px-6 py-4 text-center opacity-50 text-xs">${item.total}</td><td class="px-6 py-4 text-center font-bold text-xs">${item.completed}</td><td class="px-6 py-4 text-right text-indigo-400 font-bold">%${perc}</td>`;
                table.appendChild(row);
            });

            const overall = tTarget > 0 ? Math.round((tDone/tTarget)*100) : 0;
            summary.innerHTML = `<div class="bg-indigo-600 p-5 rounded-3xl text-white shadow-xl flex flex-col justify-center text-center"><p class="text-[10px] font-bold uppercase opacity-60 m-0">Genel Ba≈üarƒ±</p><p class="text-3xl font-black m-0 mt-1">%${overall}</p></div><div class="glass-card p-5 rounded-3xl text-white flex flex-col justify-center text-center"><p class="opacity-40 text-[10px] font-bold uppercase m-0">Biten</p><p class="text-3xl font-black m-0">${tDone}</p></div><div class="glass-card p-5 rounded-3xl text-white flex flex-col justify-center text-center"><p class="opacity-40 text-[10px] font-bold uppercase m-0">Kalan</p><p class="text-3xl font-black m-0">${tTarget - tDone}</p></div><div class="glass-card p-5 rounded-3xl text-white flex flex-col justify-center text-center"><p class="opacity-40 text-[10px] font-bold uppercase m-0">Kategori</p><p class="text-3xl font-black m-0">${data.length}</p></div>`;
        }

        function renderEditor() {
            const list = document.getElementById('editor-list');
            if(!list) return;
            list.innerHTML = '';
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'p-4 bg-slate-800/40 rounded-xl border border-slate-700 space-y-3 relative text-left';
                div.innerHTML = `<button onclick="removeCategory('${item.id}')" class="absolute top-2 right-2 text-rose-500 text-xs border-none bg-transparent cursor-pointer">Sil</button><div><label class="text-[10px] opacity-50 block mb-1">Ba≈ülƒ±k</label><input type="text" value="${item.title}" class="custom-input text-white" onchange="updateValue('${item.id}', 'title', this.value)"></div><div class="grid grid-cols-2 gap-2"><div><label class="text-[10px] opacity-50">TAMAM</label><input type="number" value="${item.completed}" class="custom-input" onchange="updateValue('${item.id}, 'completed', this.value)"></div><div><label class="text-[10px] opacity-50">HEDEF</label><input type="number" value="${item.total}" class="custom-input" onchange="updateValue('${item.id}, 'total', this.value)"></div></div>`;
                list.appendChild(div);
            });
        }

        function updateRadar() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if(radarChart) radarChart.destroy();
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: data.map(d => d.title),
                    datasets: [{
                        label: 'Tamamlanma %',
                        data: data.map(d => (d.completed/d.total)*100),
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: '#6366f1',
                        borderWidth: 2,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { r: { angleLines: { color: 'rgba(255,255,255,0.05)' }, grid: { color: 'rgba(255,255,255,0.05)' }, pointLabels: { color: '#94a3b8', font: { size: 9, weight: '600' } }, ticks: { display: false }, suggestedMin: 0, suggestedMax: 100 } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function useLocalData() {
            data = initialData;
            render(); updateRadar(); renderEditor();
        }

        // Ba≈ülat
        startApp();
    </script>
</body>
</html>