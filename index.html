<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Birikim KoÃ§um | Gelir-Gider Takip</title>
    
    <!-- PWA ve Mobil Uygulama AyarlarÄ± -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2563eb">
    <meta name="application-name" content="Birikim KoÃ§um">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        /* 1. MADDENÄ°N Ã‡Ã–ZÃœMÃœ: MOBÄ°L Ã–LÃ‡EKLENDÄ°RME */
        html {
            font-size: 14px; /* Mobilde her ÅŸeyi %15-20 oranÄ±nda kÃ¼Ã§Ã¼ltÃ¼r */
        }
        @media (min-width: 768px) {
            html { font-size: 16px; } /* Bilgisayarda normale dÃ¶n */
        }

        /* Mobil Uygulama Hissi */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
            color: #1e293b;
            -webkit-tap-highlight-color: transparent;
            user-select: none; 
            -webkit-user-select: none;
            overflow-x: hidden;
            padding-bottom: 90px; /* Alt menÃ¼ (Bottom Nav) iÃ§in boÅŸluk */
        }
        
        /* Ä°nput alanlarÄ±nda seÃ§ime izin ver */
        input, textarea { user-select: text; -webkit-user-select: text; }

        .glass-card { background: rgba(255, 255, 255, 0.98); border: 1px solid rgba(255,255,255,0.6); box-shadow: 0 4px 20px -5px rgba(0,0,0,0.05); }
        .hidden { display: none !important; }
        input[type="range"] { accent-color: #2563eb; }
        .overlay { background: rgba(0,0,0,0.4); opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 40; }
        .overlay.active { opacity: 1; pointer-events: auto; }
        .custom-scrollbar::-webkit-scrollbar { width: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .health-detail { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .health-detail.open { max-height: 1000px; transition: max-height 0.5s ease-in; }
        
        .fade-text { animation: textFade 0.5s ease-in-out; }
        @keyframes textFade { 0% { opacity: 0; } 100% { opacity: 1; } }

        /* YanÄ±p SÃ¶nme Efektleri */
        @keyframes pulse-red { 0%, 100% { color: #ef4444; text-shadow: 0 0 5px rgba(239, 68, 68, 0.2); } 50% { color: #fca5a5; text-shadow: 0 0 15px rgba(239, 68, 68, 0.6); } }
        @keyframes pulse-green { 0%, 100% { color: #16a34a; text-shadow: 0 0 5px rgba(22, 163, 74, 0.2); } 50% { color: #86efac; text-shadow: 0 0 15px rgba(22, 163, 74, 0.6); } }
        .animate-pulse-red { animation: pulse-red 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-pulse-green { animation: pulse-green 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        /* 6. ve 7. MADDELERÄ°N Ã‡Ã–ZÃœMÃœ: Side Panel AnimasyonlarÄ± (SaÄŸdan Kayan) */
        .side-panel {
            position: fixed; top: 0; right: 0; height: 100%; width: 85%; max-width: 26rem; 
            background: #ffffff; z-index: 60; box-shadow: -5px 0 25px rgba(0,0,0,0.15);
            transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        .side-panel.open { transform: translateX(0); }

        /* YENÄ° Ã–ZELLÄ°K: Alt Navigasyon BarÄ± (Bottom Nav) */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 75px;
            background: white; border-top: 1px solid #f1f5f9;
            display: flex; justify-content: space-around; items-center;
            z-index: 50; padding-bottom: env(safe-area-inset-bottom);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.03);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 18%; height: 100%; color: #94a3b8; transition: color 0.2s; cursor: pointer;
        }
        .nav-item:active { color: #2563eb; transform: scale(0.95); }
        .nav-item i { font-size: 1.3rem; margin-bottom: 4px; }
        .nav-item span { font-size: 0.65rem; font-weight: 700; }
        
        /* Floating Action Button (Ortadaki Ekle Butonu) */
        .fab-container { position: relative; top: -25px; }
        .fab {
            width: 64px; height: 64px; background: #2563eb; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 1.5rem;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
            transition: transform 0.2s; cursor: pointer;
        }
        .fab:active { transform: scale(0.9); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center bg-slate-50">

    <div id="overlay" class="overlay fixed inset-0 z-40" onclick="closeAllPopups()"></div>
    
    <div id="saveIndicator" class="fixed top-4 right-4 bg-white px-3 py-1.5 rounded-full shadow-lg border border-gray-100 flex items-center gap-2 text-[10px] font-bold text-gray-500 opacity-0 transition-opacity duration-500 pointer-events-none z-[70]">
        <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div> Kaydedildi
    </div>

    <!-- 1. GÄ°RÄ°Åž EKRANI -->
    <!-- LOGO BÃœYÃœTÃœLDÃœ -->
    <div id="loginScreen" class="w-[90%] max-w-sm glass-card p-6 rounded-[2.5rem] shadow-2xl space-y-6 my-auto relative overflow-hidden animate-fade-in">
        <div class="text-center">
            <div class="mx-auto mb-4 w-40 h-40 hover:scale-105 transition-transform duration-300">
                <img src="logo.png" alt="Logo" class="w-full h-full object-contain drop-shadow-lg" 
                     onerror="this.src='https://cdn-icons-png.flaticon.com/512/2382/2382461.png'; this.parentElement.classList.add('opacity-80');">
            </div>
            
            <h1 class="text-3xl font-black text-gray-900 tracking-tight mb-1" id="loginTitle">Birikim KoÃ§um</h1>
            <p class="text-blue-500 text-xs font-bold uppercase tracking-widest" id="loginSubtitle">Gelir - Gider Takip AsistanÄ±</p>
        </div>
        
        <div class="space-y-3 mt-6" id="authFormContainer">
            <div id="registerFields" class="hidden space-y-3">
                <input type="text" id="regUsernameInput" class="w-full p-4 bg-white border border-gray-200 rounded-2xl outline-none font-bold text-gray-700 transition-all text-sm" placeholder="KullanÄ±cÄ± AdÄ± Belirle (Zorunlu)">
                <input type="text" id="regInviteCode" class="w-full p-4 bg-white border border-gray-200 rounded-2xl outline-none font-bold text-gray-700 transition-all text-sm" placeholder="Davet Kodu (Varsa)">
                <input type="number" id="regDailyLimit" class="w-full p-4 bg-blue-50 border border-blue-200 rounded-2xl outline-none font-black text-blue-700 transition-all text-sm hidden placeholder-blue-400" placeholder="GÃ¼nlÃ¼k Harcama Hedefiniz (TL)">
            </div>
            
            <input type="text" id="emailInput" class="w-full p-4 bg-white border border-gray-200 rounded-2xl outline-none font-bold text-gray-700 transition-all text-sm" placeholder="E-posta veya KullanÄ±cÄ± AdÄ±">
            <input type="password" id="passwordInput" class="w-full p-4 bg-white border border-gray-200 rounded-2xl outline-none font-bold text-gray-700 transition-all text-sm" placeholder="Åžifre">
            
            <button id="loginBtn" onclick="firebaseLogin()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-lg shadow-blue-200 active:scale-95 transition-all hover:bg-blue-700 flex justify-center items-center gap-2">
                <span>GiriÅŸ Yap</span>
            </button>
            
            <button id="registerBtn" onclick="firebaseRegister()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-xl hidden active:scale-95 transition-all hover:bg-indigo-700 flex justify-center items-center gap-2">
                <span>Ãœye Ol ve KatÄ±l</span>
            </button>
            
            <p id="forgotPassText" class="text-center text-[11px] font-bold text-blue-400 cursor-pointer hover:text-blue-600 pt-2" onclick="forgotPassword()">Åžifremi Unuttum?</p>

            <p id="backToLoginText" class="text-center text-xs font-bold text-gray-400 cursor-pointer hover:text-blue-500 hidden pt-2" onclick="showLoginMode()">
                <i class="fas fa-arrow-left mr-1"></i> GiriÅŸ ekranÄ±na dÃ¶n
            </p>
        </div>
        
        <div class="relative py-4">
            <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200"></div></div>
            <div class="relative flex justify-center"><span class="bg-white px-4 text-xs font-bold text-gray-400 uppercase">veya</span></div>
        </div>

        <div class="space-y-3" id="actionButtons">
            <button onclick="startWizard(false)" class="w-full bg-green-500 text-white font-black py-4 rounded-2xl shadow-lg shadow-green-100 active:scale-95 transition-all hover:bg-green-600 flex items-center justify-center gap-2">
                <i class="fas fa-magic"></i> <span>Plana BaÅŸla</span>
            </button>
            
            <button onclick="showQuickRegisterMode()" class="w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-2xl active:scale-95 transition-all hover:bg-slate-900 shadow-md flex items-center justify-center gap-3 text-xs leading-tight">
                <i class="fas fa-bolt text-yellow-400 text-lg"></i> <span class="text-left">Veri girmek istemiyorum,<br>sadece gÃ¼nlÃ¼k harcama hesaplayacaÄŸÄ±m</span>
            </button>

            <p class="text-[10px] text-center text-gray-400 px-4 mt-2">BÃ¼tÃ§eni oluÅŸturmaya baÅŸla, en son adÄ±mda kaydedip Ã¼ye ol.</p>
            <button onclick="showRegisterMode()" class="w-full bg-white border-2 border-gray-100 text-gray-600 font-bold py-3 rounded-2xl active:scale-95 transition-all hover:border-indigo-200 hover:text-indigo-600 mt-2">
                Bir Plana Dahil Ol
            </button>
        </div>

        <!-- GÄ°RÄ°Åž EKRANI BÄ°ZE ULAÅžIN -->
        <div class="mt-8 text-center pt-4 border-t border-gray-100">
            <button onclick="openContactModal()" class="text-[10px] font-bold text-gray-400 hover:text-blue-500 transition-colors">
                <i class="fas fa-envelope mr-1"></i> Bize UlaÅŸÄ±n
            </button>
        </div>
    </div>

    <!-- 2. SÄ°HÄ°RBAZ (WIZARD) -->
    <!-- Eski Kodun Sihirbaz YapÄ±sÄ± Korundu -->
    <div id="wizardScreen" class="w-[95%] max-w-lg glass-card p-6 rounded-[2.5rem] shadow-2xl hidden space-y-4 my-auto relative animate-fade-in pb-10">
        <div class="flex justify-between items-center mb-4">
            <div id="wizardProgress" class="flex gap-1 flex-1 mr-4"></div>
            <span class="text-xs font-bold text-gray-300" id="stepCount">1/8</span>
        </div>
        <div id="wizardContent" class="min-h-[420px] flex flex-col relative"></div>
        <div class="flex gap-3 mt-4" id="wizardNavBtns">
             <button onclick="wizardBack()" class="flex-1 bg-gray-100 text-gray-600 font-bold py-4 rounded-2xl hover:bg-gray-200 transition-all">Geri</button>
             <button onclick="wizardNext()" id="wizNextBtn" class="flex-[2] bg-blue-600 text-white font-black py-4 rounded-2xl shadow-xl active:scale-95 transition-all hover:bg-blue-700">Devam Et</button>
        </div>
    </div>

    <!-- 3. DASHBOARD -->
    <div id="dashboardScreen" class="w-full max-w-md hidden px-4 pt-4 pb-24 animate-fade-in flex flex-col gap-6">
        
        <!-- Esprili Mesaj AlanÄ± -->
        <div id="motivationArea" class="hidden w-full p-4 rounded-3xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white shadow-lg animate-fade-in">
            <div class="flex items-start gap-3">
                <div class="text-2xl mt-1">ðŸ¤–</div>
                <div>
                    <p class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">Durum Raporu</p>
                    <p class="font-black text-sm md:text-base leading-tight" id="motivationText">...</p>
                </div>
            </div>
        </div>

        <!-- Davet Bildirim AfiÅŸi -->
        <div id="inviteBanner" class="hidden bg-indigo-600 text-white p-4 rounded-3xl shadow-lg flex flex-col sm:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-envelope-open-text"></i></div>
                <div>
                    <p class="text-[10px] text-indigo-200 font-bold uppercase tracking-widest">Yeni Plan Daveti</p>
                    <p class="font-black text-sm" id="inviteBannerText">Sizi planÄ±na davet ediyor.</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="rejectInvite()" class="px-5 py-2 bg-white/10 hover:bg-white/20 rounded-xl text-xs font-bold transition-colors">Reddet</button>
                <button onclick="acceptInvite()" class="px-5 py-2 bg-white text-indigo-600 hover:bg-indigo-50 rounded-xl text-xs font-black transition-colors shadow-sm">Kabul Et</button>
            </div>
        </div>

        <!-- ADMIN MOD UYARISI -->
        <div id="adminModeBanner" class="hidden bg-red-600 text-white p-3 rounded-xl shadow-lg mb-4 flex justify-between items-center animate-fade-in">
             <div class="flex items-center gap-2">
                 <i class="fas fa-user-secret text-xl"></i>
                 <div>
                     <p class="text-[10px] font-bold uppercase opacity-80">Admin Modu</p>
                     <p class="text-xs font-bold">Åžu an incelenen kullanÄ±cÄ±: <span id="adminInspectName" class="font-black underline">...</span></p>
                 </div>
             </div>
             <button onclick="exitAdminInspect()" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-xs font-bold transition-colors">Ã‡Ä±kÄ±ÅŸ</button>
        </div>

        <div class="flex justify-between items-center px-1">
            <div>
                <h2 class="text-2xl font-black text-gray-800 tracking-tight" id="dashWelcome">Panelim</h2>
                <div class="flex items-center gap-2">
                    <span id="roleBadge" class="text-[9px] font-black bg-blue-100 text-blue-600 px-2 py-0.5 rounded uppercase tracking-wide">YÃ¶netici</span>
                </div>
            </div>
            <div class="flex gap-2">
                <!-- ADMIN BUTONU (Sadece belirli e-postada gÃ¶rÃ¼nÃ¼r) -->
                <button onclick="openAdminPanel()" id="btnAdmin" class="hidden text-[10px] font-black bg-red-500 text-white border border-red-600 px-4 py-2 rounded-full uppercase tracking-widest shadow-sm hover:bg-red-600"><i class="fas fa-shield-alt"></i> Admin</button>
            </div>
        </div>

        <!-- Ana Durum KartÄ± -->
        <!-- 3. MADDENÄ°N Ã‡Ã–ZÃœMÃœ: KÃ¼Ã§Ã¼ltme buraya da uygulandÄ± -->
        <div class="w-full p-6 rounded-[2.5rem] bg-gradient-to-br from-slate-800 to-slate-900 text-white shadow-2xl relative overflow-hidden group">
            <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500 rounded-full mix-blend-overlay filter blur-3xl opacity-20 -mr-16 -mt-16"></div>
            <div class="relative z-10">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <p class="text-slate-400 text-[10px] font-bold uppercase tracking-widest opacity-80">BugÃ¼nÃ¼n Limiti</p>
                            <button onclick="openCalcModal()" class="text-blue-300 hover:text-white text-[9px] font-bold underline decoration-dashed underline-offset-2 transition-colors cursor-pointer relative z-20">NasÄ±l HesaplandÄ±?</button>
                        </div>
                        <h2 id="displayDailyLimit" class="text-6xl font-black tracking-tighter leading-none">â‚º0</h2>
                    </div>
                    <div class="text-right">
                        <p onclick="openBalanceModal()" class="text-blue-400 text-[10px] font-bold uppercase tracking-widest mb-1 underline decoration-dashed underline-offset-4 cursor-pointer hover:text-blue-200 transition-colors" title="Detay iÃ§in tÄ±kla">GerÃ§ek Bakiye</p>
                        <h4 id="displayCumulativeLimit" onclick="openBalanceModal()" class="text-4xl font-black text-white tracking-tight cursor-pointer">â‚º0</h4>
                    </div>
                </div>
                <div class="flex items-center gap-3 mt-8 pt-6 border-t border-white/10">
                    <div class="bg-white/10 px-4 py-2 rounded-xl backdrop-blur-md border border-white/5">
                        <span class="text-[9px] text-slate-300 font-bold uppercase block">MaaÅŸa Kalan</span>
                        <span id="displayRemainingDays" class="text-lg font-black text-white">-- GÃ¼n</span>
                    </div>
                    <div class="bg-white/10 px-4 py-2 rounded-xl backdrop-blur-md border border-white/5">
                        <span class="text-[9px] text-slate-300 font-bold uppercase block">Hedef Birikim</span>
                        <span id="sumSavings" class="text-lg font-black text-green-400">â‚º0</span>
                    </div>
                    <button onclick="startWizard(true)" id="btnEditPlan" class="bg-white/10 px-4 py-2 rounded-xl backdrop-blur-md border border-white/5 hover:bg-white/20 transition-all flex flex-col items-center justify-center min-w-[80px]">
                        <i class="fas fa-pen text-sm mb-1 text-slate-300"></i>
                        <span class="text-[9px] text-slate-300 font-bold uppercase block">DÃ¼zenle</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 2. MADDENÄ°N Ã‡Ã–ZÃœMÃœ: Aile Paneli Buradan KaldÄ±rÄ±ldÄ± ve Ayarlar'a TaÅŸÄ±ndÄ± -->

        <!-- 4. MADDENÄ°N Ã‡Ã–ZÃœMÃœ: Harcama Ekleme Dikey YerleÅŸimi (Kategori -> Tutar -> AÃ§Ä±klama) -->
        <div class="glass-card p-6 rounded-[2.5rem] bg-white border border-gray-100 shadow-md">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-black text-lg text-gray-800">Harcama Ekle</h3>
                <span id="todayTotal" class="text-[9px] font-bold bg-blue-100 text-blue-700 px-3 py-1 rounded-lg uppercase tracking-wide">BugÃ¼n: â‚º0</span>
            </div>
            
            <div class="flex flex-col gap-4">
                <!-- Kategori -->
                <div class="w-full relative">
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide ml-1">Kategori</label>
                    <div class="relative mt-1">
                        <select id="expCat" class="w-full p-4 bg-gray-50 rounded-2xl font-bold text-sm text-gray-700 outline-none border border-gray-100 appearance-none">
                             <!-- Categories injected here -->
                        </select>
                        <i class="fas fa-chevron-down absolute right-4 top-4 text-gray-400 text-xs pointer-events-none"></i>
                        <button onclick="openCategoryModal()" class="absolute right-10 top-0 h-full px-3 text-gray-400 hover:text-blue-500 border-l border-gray-200" title="Kategori DÃ¼zenle">
                            <i class="fas fa-pencil-alt text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- Tutar -->
                 <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide ml-1">Tutar (TL)</label>
                    <input type="number" id="expAmt" placeholder="0" class="w-full p-4 mt-1 bg-gray-50 rounded-2xl font-black text-2xl text-gray-800 outline-none focus:ring-2 focus:ring-blue-100 border border-gray-100">
                 </div>

                <!-- AÃ§Ä±klama ve Buton -->
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide ml-1">AÃ§Ä±klama</label>
                    <div class="flex gap-3 mt-1">
                        <input type="text" id="expDesc" placeholder="Ã–rn: Kahve" class="flex-1 p-4 bg-gray-50 rounded-2xl font-bold text-gray-600 outline-none text-sm border border-gray-100">
                        <input type="hidden" id="editExpIndex" value="-1">
                        <button id="addExpBtn" onclick="addExpense()" class="bg-blue-600 text-white w-16 rounded-2xl active:scale-90 transition-all shadow-lg shadow-blue-200 flex items-center justify-center shrink-0">
                            <i class="fas fa-plus text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <!-- HÄ±zlÄ± Tarih SeÃ§ici -->
                <div class="flex justify-between items-center mt-2 bg-gray-50 p-2 rounded-xl">
                     <button onclick="changeExpenseDate(1)" class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 text-xs shadow-sm"><i class="fas fa-chevron-left"></i></button>
                     <div class="relative">
                        <span id="expenseDateLabel" class="text-xs font-bold text-gray-500 select-none" onclick="document.getElementById('expDateInputHidden').showPicker()">BugÃ¼n</span>
                        <input type="date" id="expDateInputHidden" class="absolute inset-0 opacity-0 w-full h-full cursor-pointer">
                     </div>
                     <button onclick="changeExpenseDate(-1)" class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 text-xs shadow-sm"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>

        <div class="glass-card p-8 rounded-[3rem] shadow-xl bg-white border border-gray-100">
            <h3 class="font-black text-xl text-gray-800 uppercase tracking-widest text-[11px] mb-4">Harcama GeÃ§miÅŸi</h3>
            <div id="historyList" class="pb-4"></div>
        </div>

        <div id="financialHealthSection" class="glass-card p-10 rounded-[3rem] space-y-8 bg-white border border-blue-50 shadow-xl">
            <div class="flex flex-col items-center border-b pb-8">
                <h3 class="font-black text-3xl text-gray-800 mb-2">Finansal SaÄŸlÄ±k</h3>
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-4">Net VarlÄ±k (VarlÄ±k - BorÃ§)</p>
                <div id="netStatusBadge" class="text-4xl font-black text-gray-800 px-8 py-4 bg-gray-50 rounded-[2rem] transition-colors">
                    <span id="netStatusVal">â‚º0</span>
                </div>
                
                <div class="flex items-center justify-center mt-6">
                    <div class="text-center"><span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">AylÄ±k Sabit Gider</span><br><span id="sumGiderTotalHealth" class="text-xl font-black text-red-600">â‚º0</span></div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 gap-8">
                <!-- VarlÄ±klar -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-2 pb-2 border-b border-green-100">
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        <span class="text-xs font-black text-green-600 uppercase tracking-widest">VarlÄ±klar & Birikim</span>
                    </div>
                    <div id="detailedAssetsList" class="space-y-3 min-h-[50px]"></div>
                    <button onclick="toggleInlineAdd('dashAsset')" class="w-full py-3 text-[10px] text-gray-400 border border-dashed border-gray-300 rounded-xl hover:text-gray-600 transition-colors">+ Yeni VarlÄ±k Ekle</button>
                    <!-- INLINE ADD FOR ASSETS -->
                    <div id="inlineAdddashAssetContainer" class="hidden p-4 bg-green-50 rounded-2xl space-y-3 border border-green-100">
                         <select id="dashAssetType" onchange="handleInlineTypeChange('dashAsset')" class="w-full p-3 text-xs rounded-xl border-none font-bold text-green-700 outline-none"><option value="DiÄŸer">Nakit (TL)</option><option value="AltÄ±n">AltÄ±n</option><option value="DÃ¶viz">DÃ¶viz</option><option value="GÃ¼mÃ¼ÅŸ">GÃ¼mÃ¼ÅŸ</option></select>
                         <div id="dashAssetFields" class="space-y-2"></div>
                         <div class="flex gap-2"><button onclick="cancelInlineAdd('dashAsset')" class="flex-1 py-2 bg-white text-xs rounded-xl border border-gray-200 font-bold text-gray-500">Ä°ptal</button><button onclick="saveInlineAdd('dashAsset')" class="flex-1 py-2 bg-green-500 text-white text-xs rounded-xl font-bold shadow-lg shadow-green-200">Kaydet</button></div>
                    </div>
                </div>

                <!-- BorÃ§lar -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-2 pb-2 border-b border-red-100">
                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        <span class="text-xs font-black text-red-600 uppercase tracking-widest">BorÃ§lar & Krediler</span>
                    </div>
                    <div id="detailedDebtsList" class="space-y-3 min-h-[50px]"></div>
                    <button onclick="toggleInlineAdd('dashDebt')" class="w-full py-3 text-[10px] text-gray-400 border border-dashed border-gray-300 rounded-xl hover:text-gray-600 transition-colors">+ Yeni BorÃ§ Ekle</button>
                    <!-- INLINE ADD FOR DEBTS -->
                    <div id="inlineAdddashDebtContainer" class="hidden p-4 bg-red-50 rounded-2xl space-y-3 border border-red-100">
                         <select id="dashDebtType" onchange="handleInlineTypeChange('dashDebt')" class="w-full p-3 text-xs rounded-xl border-none font-bold text-red-700 outline-none"><option value="Kredi">Kredi</option><option value="Kredi KartÄ±">Kredi KartÄ±</option><option value="AltÄ±n">AltÄ±n</option><option value="DÃ¶viz">DÃ¶viz</option><option value="DiÄŸer">DiÄŸer</option></select>
                         <div id="dashDebtFields" class="space-y-2"></div>
                         <div class="flex gap-2"><button onclick="cancelInlineAdd('dashDebt')" class="flex-1 py-2 bg-white text-xs rounded-xl border border-gray-200 font-bold text-gray-500">Ä°ptal</button><button onclick="saveInlineAdd('dashDebt')" class="flex-1 py-2 bg-red-500 text-white text-xs rounded-xl font-bold shadow-lg shadow-red-200">Kaydet</button></div>
                    </div>
                </div>
            </div>
            
            <!-- SABÄ°T GÄ°DERLER AKORDÄ°YONU -->
            <div id="fixedExpensesSection" class="w-full pt-4"></div>
            
            <!-- DASHBOARD BÄ°ZE ULAÅžIN -->
            <div class="text-center mt-6 pt-6 border-t border-gray-100">
                <button onclick="openContactModal()" class="text-xs font-bold text-gray-400 hover:text-blue-500 transition-colors">
                    <i class="fas fa-comment-alt mr-1"></i> GÃ¶rÃ¼ÅŸ ve Ã–neri Bildir
                </button>
            </div>
        </div>
    </div>

    <!-- 7. MADDENÄ°N Ã‡Ã–ZÃœMÃœ: Bottom Navbar (Sabit Alt MenÃ¼) -->
    <nav id="bottomNavbar" class="bottom-nav hidden">
        <div class="nav-item" onclick="openSidePanel('settingsModal')">
            <i class="fas fa-users"></i>
            <span>Aile/Ayarlar</span>
        </div>
        <div class="nav-item" onclick="showAnalysisScreen()">
            <i class="fas fa-chart-pie"></i>
            <span>Analiz</span>
        </div>
        
        <div class="fab-container">
            <div class="fab" onclick="document.querySelector('.glass-card').scrollIntoView({ behavior: 'smooth' }); setTimeout(() => document.getElementById('expAmt').focus(), 300);">
                <i class="fas fa-plus"></i>
            </div>
        </div>
        
        <div class="nav-item" onclick="startWizard(true)">
            <i class="fas fa-edit"></i>
            <span>Planla</span>
        </div>
        <div class="nav-item" onclick="handleLogout()">
            <i class="fas fa-sign-out-alt text-red-400"></i>
            <span class="text-red-400">Ã‡Ä±kÄ±ÅŸ</span>
        </div>
    </nav>

    <!-- 4. ANALÄ°Z EKRANI (GÃœNCELLENMÄ°Åž VERSÄ°YON) -->
    <div id="analysisScreen" class="max-w-4xl w-full hidden space-y-8 pb-32 animate-fade-in my-auto pt-6 px-4">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-black text-gray-800 tracking-tight">Finansal Analiz</h2>
                <div class="flex items-center gap-3 mt-2">
                     <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Analiz DÃ¶nemi:</p>
                     <input type="month" id="analysisDateFilter" class="bg-gray-100 text-gray-700 text-xs font-bold p-1 rounded-lg border-none outline-none" onchange="renderCharts()">
                </div>
                <p id="analysisPeriodLabel" class="text-[10px] text-blue-500 font-bold mt-1"></p>
            </div>
            <button onclick="showDashboard()" class="text-[10px] font-black bg-gray-100 text-gray-600 border border-gray-200 px-4 py-2 rounded-full uppercase tracking-widest shadow-sm hover:bg-gray-200">Geri DÃ¶n</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-card p-6 rounded-[2.5rem] bg-white border border-gray-100 shadow-lg"><h3 class="font-black text-lg text-gray-800 mb-4 text-center">VarlÄ±k vs BorÃ§</h3><div class="h-64"><canvas id="assetsChart"></canvas></div></div>
            <div class="glass-card p-6 rounded-[2.5rem] bg-white border border-gray-100 shadow-lg"><h3 class="font-black text-lg text-gray-800 mb-4 text-center">Harcama DaÄŸÄ±lÄ±mÄ±</h3><div class="h-64"><canvas id="expensesChart"></canvas></div></div>
        </div>
        
        <!-- YENÄ° TREND GRAFÄ°ÄžÄ° -->
        <div class="glass-card p-6 rounded-[2.5rem] bg-white border border-gray-100 shadow-lg mt-6">
             <div class="flex justify-between items-center mb-4">
                 <h3 class="font-black text-lg text-gray-800 text-center flex-1">Net Durum DeÄŸiÅŸimi (Trend)</h3>
                 <div class="flex gap-2">
                     <button onclick="switchChartMode('TL')" id="btnChartTL" class="text-[10px] font-bold px-2 py-1 rounded bg-blue-100 text-blue-600">TL BazlÄ±</button>
                     <button onclick="switchChartMode('USD')" id="btnChartUSD" class="text-[10px] font-bold px-2 py-1 rounded bg-gray-100 text-gray-500 hover:bg-green-100 hover:text-green-600">USD BazlÄ±</button>
                 </div>
             </div>
             <div class="h-64"><canvas id="historyTrendChart"></canvas></div>
        </div>

        <div class="glass-card p-8 rounded-[2.5rem] bg-white border border-gray-100 shadow-lg">
            <h3 class="font-black text-xl text-gray-800 mb-4 border-b pb-2">GeÃ§miÅŸ KayÄ±t Ekle</h3>
            <div class="grid grid-cols-1 sm:grid-cols-5 gap-4 items-end">
                <div><label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">DÃ¶nem</label><input type="month" id="histDate" class="w-full p-3 bg-gray-50 rounded-xl font-bold text-sm outline-none"></div>
                <div><label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">VarlÄ±k (TL)</label><input type="number" id="histAssets" placeholder="0" class="w-full p-3 bg-gray-50 rounded-xl font-bold text-sm outline-none text-green-600"></div>
                <div><label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">BorÃ§ (TL)</label><input type="number" id="histDebts" placeholder="0" class="w-full p-3 bg-gray-50 rounded-xl font-bold text-sm outline-none text-red-600"></div>
                <!-- YENÄ° DOLAR KURU GÄ°RÄ°ÅžÄ° -->
                <div><label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Dolar Kuru</label><input type="number" step="0.01" id="histUSDRate" placeholder="Ã–rn: 30.50" class="w-full p-3 bg-blue-50 rounded-xl font-bold text-sm outline-none text-blue-600"></div>
                
                <button onclick="addHistoryRecord()" class="bg-indigo-600 text-white font-black py-3 rounded-xl shadow-lg hover:bg-indigo-700 active:scale-95 transition-all">Kaydet</button>
            </div>
            <!-- GEÃ‡MÄ°Åž KAYITLAR TABLOSU -->
            <div class="mt-6">
                <h4 class="text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide">Eklenen KayÄ±tlar</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs text-left">
                        <thead class="text-gray-400 border-b">
                            <tr>
                                <th class="pb-2">DÃ¶nem</th>
                                <th class="pb-2 text-right">VarlÄ±k</th>
                                <th class="pb-2 text-right">BorÃ§</th>
                                <th class="pb-2 text-right">Kur</th>
                                <th class="pb-2 text-center">Ä°ÅŸlem</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody" class="font-bold text-gray-700"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 6. MADDE Ã‡Ã–ZÃœMÃœ: SIDE PANEL YAPISINA DÃ–NÃœÅžTÃœRÃœLMÃœÅž AYARLAR -->
    <div id="settingsModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-slate-50">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h4 class="font-black text-xl text-gray-800 tracking-tight">Ayarlar & Aile</h4>
                <button onclick="closeSidePanel('settingsModal')" class="text-gray-300 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>

            <div class="flex-1 overflow-y-auto custom-scrollbar space-y-6 pb-20">
                <!-- 2. MADDE Ã‡Ã–ZÃœMÃœ: Aile Sistemi Buraya TaÅŸÄ±ndÄ± -->
                <div id="familyPanel" class="bg-white p-5 rounded-[2rem] border border-blue-100 shadow-sm">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-100 pb-2">
                        <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Aile Sistemi</h4>
                        <button onclick="createInviteCode()" class="text-[9px] font-bold text-blue-500 bg-blue-50 px-2 py-1 rounded-md hover:bg-blue-100 transition-colors">Kod: <span id="displayInviteCode">-----</span></button>
                    </div>
                    <div class="flex flex-col gap-2 mb-2">
                        <input type="text" id="famInput" class="w-full p-2 bg-gray-50 rounded-lg font-bold text-xs outline-none border border-gray-100" placeholder="KullanÄ±cÄ± AdÄ±/E-posta">
                        <div class="flex gap-2">
                            <select id="famRole" class="flex-1 p-2 bg-white border border-gray-100 rounded-lg text-xs font-bold text-gray-600 outline-none">
                                <option value="full">Tam Yetki</option>
                                <option value="limited">SÄ±nÄ±rlÄ±</option>
                            </select>
                            <button onclick="addFamilyMember()" class="bg-orange-500 text-white font-black px-4 rounded-lg hover:bg-orange-600 transition-all text-xs">Ekle</button>
                        </div>
                    </div>
                    <div id="familyList" class="space-y-2"></div>
                </div>

                <!-- Plan AyarlarÄ± -->
                <div class="bg-white p-5 rounded-[2rem] border border-gray-200 shadow-sm text-center">
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Mevcut Plan StatÃ¼sÃ¼</p>
                    <p class="font-black text-blue-600 text-sm" id="settingsCurrentPlanLabel">Kendi PlanÄ±nÄ±z (YÃ¶netici)</p>
                    <button id="btnLeavePlan" onclick="leaveCurrentPlan()" class="hidden mt-3 text-[10px] font-bold text-red-500 bg-red-50 px-3 py-1.5 rounded-lg w-full hover:bg-red-100 transition-colors">Ortak Plandan AyrÄ±l</button>
                </div>

                <div class="space-y-2 px-1">
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Davet Kodu Ä°le BaÅŸka Plana KatÄ±l</p>
                    <input type="text" id="settingsInviteCode" class="w-full p-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-100 outline-none font-bold text-gray-700 transition-all text-sm" placeholder="Davet Kodunu Girin">
                    <button onclick="joinPlanByCode()" class="w-full bg-blue-600 text-white font-black py-3 rounded-xl shadow-lg hover:bg-blue-700 active:scale-95 transition-all text-sm">KatÄ±l</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DÄ°ÄžER SIDE PANELLER -->
    <div id="adminModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-slate-900 text-white">
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-slate-700">
                <h4 class="font-black text-xl tracking-tight text-white"><i class="fas fa-shield-alt mr-2"></i> Admin Paneli</h4>
                <button onclick="closeSidePanel('adminModal')" class="text-slate-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                <button onclick="loadAdminUsers()" class="text-slate-400 hover:text-white ml-2"><i class="fas fa-sync-alt"></i></button>
            </div>
            
            <!-- ADMIN TABS -->
            <div class="flex gap-2 mb-4 bg-slate-800 p-1 rounded-xl">
                <button onclick="switchAdminTab('users')" id="tabAdminUsers" class="flex-1 py-2 text-xs font-bold rounded-lg bg-blue-600 text-white shadow-sm transition-all">KullanÄ±cÄ±lar</button>
                <button onclick="switchAdminTab('messages')" id="tabAdminMessages" class="flex-1 py-2 text-xs font-bold rounded-lg text-slate-400 hover:text-white transition-all">Mesajlar</button>
            </div>

            <div id="adminTabUsers" class="flex-1 flex flex-col min-h-0">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                        <p class="text-[9px] font-bold uppercase text-slate-400">KullanÄ±cÄ±lar</p>
                        <p class="text-2xl font-black text-white" id="adminTotalUsers">-</p>
                    </div>
                     <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                        <p class="text-[9px] font-bold uppercase text-slate-400">YÃ¶netilen Para</p>
                        <p class="text-xl font-black text-green-400" id="adminTotalMoney">-</p>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto custom-scrollbar pb-10">
                    <table class="w-full text-xs text-left">
                         <thead class="text-slate-500 font-bold uppercase border-b border-slate-700 sticky top-0 bg-slate-900">
                             <tr><th class="pb-3 pl-1">KullanÄ±cÄ±</th><th class="pb-3 text-right">Ä°ÅŸlem</th></tr>
                         </thead>
                         <tbody id="adminUserList" class="font-bold text-slate-300"></tbody>
                     </table>
                </div>
            </div>

            <div id="adminTabMessages" class="hidden flex-1 flex flex-col min-h-0">
                 <div class="flex-1 overflow-y-auto custom-scrollbar pb-10 space-y-3" id="adminMessageList"></div>
            </div>
        </div>
    </div>

    <!-- DÃœZENLEME SIDE PANEL -->
    <div id="editItemModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-white">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h4 class="font-black text-xl text-gray-800 tracking-tight">DÃ¼zenle</h4>
                <button onclick="closeSidePanel('editItemModal')" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto custom-scrollbar pb-10">
                <div class="space-y-4">
                    <input type="text" id="editItemName" class="w-full p-4 bg-gray-50 rounded-xl font-bold text-sm border border-gray-100" placeholder="Ä°sim">
                    <input type="number" id="editItemVal" class="w-full p-4 bg-gray-50 rounded-xl font-bold text-sm border border-gray-100" placeholder="Toplam Tutar">
                    
                    <div class="p-4 bg-blue-50 rounded-xl border border-blue-100 flex items-center gap-3">
                         <input type="checkbox" id="editExcludeNetWorth" class="w-5 h-5 rounded text-blue-600 focus:ring-blue-500">
                         <label for="editExcludeNetWorth" class="text-xs font-bold text-gray-600">Net VarlÄ±k HesabÄ±na Katma</label>
                    </div>
                    
                    <input type="hidden" id="editItemType"><input type="hidden" id="editItemIndex">
                    <div class="flex gap-2 pt-4">
                        <button onclick="closeSidePanel('editItemModal')" class="flex-1 py-3 bg-gray-100 text-gray-600 font-bold rounded-xl border border-gray-200">Ä°ptal</button>
                        <button onclick="saveEditedItem()" class="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg shadow-blue-200">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- HESAPLAMA DETAY SIDE PANEL -->
    <div id="calcModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-white">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h4 class="font-black text-xl text-gray-800 tracking-tight">NasÄ±l HesaplandÄ±?</h4>
                <button onclick="closeSidePanel('calcModal')" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="calcModalContent" class="space-y-4 text-sm flex-1 overflow-y-auto custom-scrollbar pb-10"></div>
        </div>
    </div>

    <!-- GERÃ‡EK BAKÄ°YE SIDE PANEL -->
    <div id="balanceModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-white">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h4 class="font-black text-xl text-gray-800 tracking-tight">GerÃ§ek Bakiye</h4>
                <button onclick="closeSidePanel('balanceModal')" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="balanceModalContent" class="space-y-4 text-sm flex-1 overflow-y-auto custom-scrollbar pb-10"></div>
        </div>
    </div>

    <!-- KREDÄ° PLAN SIDE PANEL -->
    <div id="loanPlanModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-white">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <div>
                    <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Kredi DetayÄ±</span>
                    <h4 class="font-black text-xl text-gray-800 tracking-tight leading-none" id="loanPlanTitle">Ã–deme PlanÄ±</h4>
                </div>
                <button onclick="closeSidePanel('loanPlanModal')" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto custom-scrollbar pb-10">
                 <table class="w-full text-xs text-left">
                     <thead class="text-gray-400 font-bold uppercase border-b sticky top-0 bg-white"><tr><th class="pb-3 pl-2">Tak.</th><th class="pb-3">Tarih</th><th class="pb-3 text-right">Tutar</th><th class="pb-3 text-center">Durum</th></tr></thead>
                     <tbody id="loanPlanBody" class="font-bold text-gray-600"></tbody>
                 </table>
            </div>
        </div>
    </div>

    <!-- KATEGORÄ° SIDE PANEL -->
    <div id="categoryModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-white">
             <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h4 class="font-black text-xl text-gray-800 tracking-tight">Kategoriler</h4>
                <button onclick="closeSidePanel('categoryModal')" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex gap-2 mb-4">
                <input type="text" id="newCatName" placeholder="Yeni Kategori Ekle" class="flex-1 p-3 bg-gray-50 border rounded-xl text-sm font-bold outline-none" onkeyup="if(event.key==='Enter') addNewCategory()">
                <button onclick="addNewCategory()" class="bg-blue-600 text-white w-12 rounded-xl flex items-center justify-center hover:bg-blue-700 shadow-lg"><i class="fas fa-plus"></i></button>
            </div>
            
            <div id="categoryList" class="flex-1 overflow-y-auto custom-scrollbar space-y-2 pb-10"></div>
        </div>
    </div>

    <!-- Ä°LETÄ°ÅžÄ°M SIDE PANEL -->
    <div id="contactModal" class="side-panel">
        <div class="p-6 h-full flex flex-col bg-white">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h4 class="font-black text-xl text-gray-800 tracking-tight">Bize UlaÅŸÄ±n</h4>
                <button onclick="closeSidePanel('contactModal')" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 flex flex-col gap-4">
                <p class="text-sm text-gray-500">GÃ¶rÃ¼ÅŸ, Ã¶neri veya ÅŸikayetlerinizi bizimle paylaÅŸÄ±n. Size en kÄ±sa sÃ¼rede dÃ¶nÃ¼ÅŸ yapacaÄŸÄ±z.</p>
                <!-- YENÄ°: E-POSTA ALANI -->
                <input type="email" id="contactEmail" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl text-sm font-bold text-gray-700 outline-none focus:ring-4 focus:ring-blue-100 transition-all" placeholder="E-posta Adresiniz (GiriÅŸ yapmadÄ±ysanÄ±z zorunlu)">
                
                <textarea id="contactMsg" rows="6" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl text-sm font-bold text-gray-700 outline-none focus:ring-4 focus:ring-blue-100 transition-all resize-none" placeholder="MesajÄ±nÄ±z..."></textarea>
                <button onclick="sendContactMessage()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-xl active:scale-95 transition-all hover:bg-blue-700">GÃ–NDER</button>
            </div>
        </div>
    </div>

    <script>
        // --- SIDE PANEL AÃ‡MA KAPAMA FONKSÄ°YONLARI ---
        // Eski kodda openModal/closeModal vardÄ±, bunlarÄ± Side Panel mantÄ±ÄŸÄ±na Ã§eviriyoruz
        function openSidePanel(id) {
            const el = document.getElementById(id);
            if(!el) return;
            el.classList.remove('hidden');
            // Timeout animasyonun Ã§alÄ±ÅŸmasÄ± iÃ§in gerekli
            setTimeout(() => el.classList.add('open'), 10);
            document.getElementById('overlay').classList.add('active');
        }

        function closeSidePanel(id) {
            const el = document.getElementById(id);
            if(!el) return;
            el.classList.remove('open');
            setTimeout(() => el.classList.add('hidden'), 300);
            document.getElementById('overlay').classList.remove('active');
        }

        function closeAllPopups() {
            document.getElementById('overlay').classList.remove('active');
            document.querySelectorAll('.fixed.z-50').forEach(el => { if(el.id !== 'saveIndicator') el.classList.add('hidden'); });
            document.querySelectorAll('.side-panel').forEach(el => { el.classList.remove('open'); setTimeout(() => el.classList.add('hidden'), 300); });
        }

        // --- WRAPPER FONKSÄ°YONLAR (ESKÄ° KODUN Ã‡AÄžIRDIÄžI FONKSÄ°YONLAR) ---
        // Orijinal kodda "openSettingsModal" vb. isimler vardÄ±. OnlarÄ± yeni yapÄ±ya baÄŸlÄ±yoruz.
        // Ama JS mantÄ±ÄŸÄ±nÄ± bozmamak iÃ§in eski isimleri koruyup iÃ§eride openSidePanel Ã§aÄŸÄ±racaÄŸÄ±z.

        // AYARLAR
        function showSettingsModal() {
            if(currentUserRole === 'owner') {
                document.getElementById('settingsCurrentPlanLabel').innerText = "Kendi PlanÄ±nÄ±z (YÃ¶netici)";
                document.getElementById('btnLeavePlan').classList.add('hidden');
            } else {
                document.getElementById('settingsCurrentPlanLabel').innerText = "Ortak Plan (Davetli Ãœye)";
                document.getElementById('btnLeavePlan').classList.remove('hidden');
            }
            document.getElementById('settingsInviteCode').value = '';
            // Aile listesi artÄ±k burada render edilmeli
            renderFamilyList(); 
            openSidePanel('settingsModal');
        }
        function closeSettingsModal() { closeSidePanel('settingsModal'); }

        // KATEGORÄ°
        function openCategoryModal() {
            renderCategoryOptions();
            openSidePanel('categoryModal');
        }
        function closeCategoryModal() { closeSidePanel('categoryModal'); }

        // HESAPLAMA DETAY
        function openCalcModal() {
            // Orijinal iÃ§erik oluÅŸturma kodu aÅŸaÄŸÄ±da Ã§alÄ±ÅŸacak
            renderCalcContentInternal(); 
            openSidePanel('calcModal');
        }
        function closeCalcModal() { closeSidePanel('calcModal'); }

        // BAKÄ°YE
        function openBalanceModal() {
            renderBalanceContentInternal();
            openSidePanel('balanceModal');
        }
        function closeBalanceModal() { closeSidePanel('balanceModal'); }

        // KREDÄ° PLANI
        function openLoanPlanModal(loanIndex) {
            // Orijinal mantÄ±k
            const loan = state.loans[loanIndex];
            if (!loan) return;
            document.getElementById('loanPlanTitle').innerText = loan.name;
            const tbody = document.getElementById('loanPlanBody');
            tbody.innerHTML = '';
            
            let currentDate = new Date(loan.startDate || new Date());
            const monthly = loan.monthly || 0;
            const totalMonths = loan.totalMonths || 0;
            const now = new Date();

            for(let i=1; i<=totalMonths; i++) {
                const dateStr = currentDate.toLocaleDateString('tr-TR', { month: 'long', year: 'numeric', day: 'numeric' });
                const isPaid = currentDate < now && (currentDate.getMonth() !== now.getMonth() || currentDate.getFullYear() !== now.getFullYear());
                
                const tr = document.createElement('tr');
                tr.className = "border-b border-gray-100 last:border-0 hover:bg-red-50 transition-colors";
                tr.innerHTML = `
                    <td class="py-3 pl-2">${i}/${totalMonths}</td>
                    <td class="py-3">${dateStr}</td>
                    <td class="py-3 text-right">â‚º${Math.floor(monthly).toLocaleString()}</td>
                    <td class="py-3 text-center"><span class="${isPaid ? 'text-green-500 bg-green-50' : 'text-gray-400 bg-gray-100'} px-2 py-1 rounded text-[10px] uppercase font-black tracking-wider">${isPaid ? 'Ã–dendi' : 'Bekliyor'}</span></td>
                `;
                tbody.appendChild(tr);
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            openSidePanel('loanPlanModal');
        }
        function closeLoanPlanModal() { closeSidePanel('loanPlanModal'); }

        // DÃœZENLEME (EDIT)
        function openEditModal(type, index) { 
            const item = state[type][index]; 
            document.getElementById('editItemName').value = item.name; 
            document.getElementById('editItemVal').value = item.val || item.totalDebt || 0; 
            document.getElementById('editItemType').value = type; 
            document.getElementById('editItemIndex').value = index; 
            
            const chk = document.getElementById('editExcludeNetWorth');
            if (type === 'loans') chk.checked = item.excludeFromDebt || false;
            else chk.checked = item.excludeFromNetWorth || false;
            
            openSidePanel('editItemModal');
        }
        function closeEditModal() { closeSidePanel('editItemModal'); }

        // ADMIN
        function openAdminPanel() {
            openSidePanel('adminModal');
            switchAdminTab('users');
        }
        function closeAdminPanel() { closeSidePanel('adminModal'); }

        // Ä°LETÄ°ÅžÄ°M
        function openContactModal() {
            document.getElementById('contactMsg').value = '';
            document.getElementById('contactEmail').value = currentUser ? currentUser.email : '';
            openSidePanel('contactModal');
        }
        function closeContactModal() { closeSidePanel('contactModal'); }


        // --- ORÄ°JÄ°NAL JS (Sadece render fonksiyonlarÄ± gÃ¼ncellendi) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAyUQaeoVWnT4AuzSwD2M17-z1g2optqdA",
            authDomain: "hesapguvende-b07ca.firebaseapp.com",
            projectId: "hesapguvende-b07ca",
            storageBucket: "hesapguvende-b07ca.firebasestorage.app",
            messagingSenderId: "710002620092",
            appId: "1:710002620092:web:94f3ebb8dd2461af29c2b9",
            measurementId: "G-VE0EVVBM0V"
        };

        const messages_highSpend = ["CÃ¼zdan bugÃ¼n cardio yaptÄ±â€¦", "Limit: â€˜Ben bu filmde yokumâ€™ dedi.", "BugÃ¼n harcama deÄŸil, sanat eseri Ã§Ä±karmÄ±ÅŸsÄ±n.", "KartÄ±n POS cihazÄ±yla duygusal baÄŸ kurmuÅŸ olabilir.", "BÃ¼tÃ§e planÄ±: â€˜Ben yarÄ±n geliyorumâ€™ diye kaÃ§tÄ±.", "Harcama grafiÄŸi roket gibiâ€¦", "BugÃ¼n â€˜kÃ¼Ã§Ã¼k kaÃ§amakâ€™ deÄŸil, mini tatil olmuÅŸ.", "CÃ¼zdanÄ±n iÃ§ sesi: â€˜Ben aslÄ±nda inceydimâ€¦â€™", "Limitleri test ettin, tebrikler.", "BÃ¼tÃ§eye â€˜sÃ¼rpriz yumurtaâ€™ yaptÄ±n."];
        const messages_lowSavings = ["Hedefle arana mesafe girmiÅŸâ€¦", "Birikim hedefi seni Ã¶zlemiÅŸ.", "Hedef uzakta ama imkÃ¢nsÄ±z deÄŸil.", "Birikim planÄ± â€˜neredesin?â€™ dedi.", "Hedefe ÅŸu an Wi-Fi Ã§ekmiyor gibiâ€¦", "BugÃ¼n â€˜yaklaÅŸma gÃ¼nÃ¼â€™.", "Birikim hedefin el sallÄ±yor.", "Mesafe moral bozmasÄ±n.", "Hedefe uzaklÄ±k Ã¶lÃ§Ã¼mÃ¼: Bir tÄ±kâ€¦", "BugÃ¼n niyet artÄ± puan."];
        const messages_streak = ["ÃœÃ§ gÃ¼n Ã¼st Ã¼ste! HarikasÄ±n.", "Sende bir â€˜finans ninjaâ€™ enerjisi var.", "Hedef serisi baÅŸladÄ± ðŸ”¥", "CÃ¼zdanÄ±n gurur duyuyor.", "BÃ¼tÃ§e planÄ±: â€˜Ä°ÅŸte aradÄ±ÄŸÄ±m insan!â€™", "Karakter geliÅŸimi budur.", "Tasarruf kaslarÄ±n ÅŸiÅŸiyor.", "Hedef tutturan insan aurasÄ±.", "BÃ¼tÃ§e grafiÄŸi sakinleÅŸti.", "Bu gidiÅŸle paran seni iÅŸe alacak."];

        let db, auth, currentUser = null;
        let currentPlanId = null; 
        let currentUserRole = 'owner';
        let isFirebaseReady = false;
        let isRegistering = false; 
        let assetsChartInstance = null;
        let expensesChartInstance = null;
        let trendChartInstance = null;
        let trendMode = 'TL';
        let adviceInterval = null;
        window.userInvites = [];
        window.currentHistoryDateIndex = 0;
        let currentExpenseDateOffset = 0;
        let editingCategoryIndex = -1; 
        let originalAdminUid = null; 

        const defaultState = {
            step: 1, salaryDay: 15,
            registrationDate: new Date().toISOString(),
            incomes: [{ name: 'MaaÅŸ', val: null }], 
            bills: [
                { name: 'Kira', val: null }, { name: 'Aidat', val: null }, { name: 'Elektrik', val: null },
                { name: 'Su', val: null }, { name: 'DoÄŸalgaz', val: null }, { name: 'Ä°nternet', val: null },
                { name: 'Telefon', val: null }, { name: 'Bireysel Emeklilik (AylÄ±k)', val: null }
            ], 
            loans: [], debts: [], 
            otherDebts: [{ name: 'KMH / Avans Hesap (- Bakiye)', val: null }], 
            assets: [
                { name: 'Bankadaki Para', val: null }, { name: 'Cepteki Para', val: null }, { name: 'Bireysel Emeklilik (Toplam)', val: null }
            ],
            categories: ["Market / Manav", "Kasap", "AkaryakÄ±t", "Eczane / SaÄŸlÄ±k", "EÄŸlence", "EÄŸitim Ã–demeleri", "Vergi / HarÃ§ / Sigorta", "DiÄŸer"],
            manualDailyLimit: null, expenses: [], monthlyHistory: [], familyMembers: [], inviteCode: null
        };
        let state = JSON.parse(JSON.stringify(defaultState));

        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            isFirebaseReady = true;
            
            auth.onAuthStateChanged(async user => {
                if (user) {
                    currentUser = user;
                    const name = user.displayName || user.email.split('@')[0];
                    document.getElementById('dashWelcome').innerText = `HoÅŸgeldin, ${name}`;
                    
                    if (user.email.toLowerCase() === 'buraksancak@msn.com') {
                        document.getElementById('btnAdmin').classList.remove('hidden');
                    } else {
                        document.getElementById('btnAdmin').classList.add('hidden');
                    }

                    try {
                        const userDoc = await db.collection("users").doc(user.uid).get();
                        if(userDoc.exists && userDoc.data().pendingInvites) {
                            window.userInvites = userDoc.data().pendingInvites;
                        }
                    } catch(e) {}
                    
                    if (!originalAdminUid) await initUserPlan();
                } else {
                    currentUser = null;
                    showLoginScreen();
                }
            });
        } catch(e) { console.error("Firebase Init Error:", e); }

        function hideAll() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('wizardScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.add('hidden');
            document.getElementById('analysisScreen').classList.add('hidden');
            // Yeni bottom nav gizle
            document.getElementById('bottomNavbar').classList.add('hidden');
        }

        function showLoginScreen() { hideAll(); document.getElementById('loginScreen').classList.remove('hidden'); }
        function showDashboard() { 
            hideAll(); 
            document.getElementById('dashboardScreen').classList.remove('hidden'); 
            document.getElementById('bottomNavbar').classList.remove('hidden'); // Alt menÃ¼yÃ¼ gÃ¶ster
            updateDashboardUI(); 
        }
        function showAnalysisScreen() { 
            hideAll(); 
            document.getElementById('analysisScreen').classList.remove('hidden'); 
            document.getElementById('bottomNavbar').classList.remove('hidden'); // Alt menÃ¼ burada da kalsÄ±n
            
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            document.getElementById('analysisDateFilter').value = `${yyyy}-${mm}`;
            
            renderCharts(); 
            renderHistoryTable(); 
            renderTrendChart();   
        }

        // --- BURADAN SONRAKÄ° FONKSÄ°YONLAR ORÄ°JÄ°NAL MANTIÄžI KORUYOR ---
        // Sadece 'toggleInlineAdd' gibi DOM manipÃ¼lasyonu yapanlarÄ±n iÃ§ine bakÄ±p
        // eÄŸer farklÄ± id'ler kullandÄ±ysam dÃ¼zelteceÄŸim. Ama aynÄ± id'leri kullandÄ±m.

        function getRandomMessage(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

        function checkGamificationStatus() {
            const todayStr = new Date().toLocaleDateString('tr-TR');
            const dailyLimit = state.manualDailyLimit || 0;
            const spentToday = state.expenses.filter(e => e.date === todayStr).reduce((s,e)=>s+e.amount,0);
            
            if (spentToday > dailyLimit && dailyLimit > 0) {
                return getRandomMessage(messages_highSpend);
            }
            // ... (Kalan mantÄ±k aynÄ±) ...
            return "Finansal yolculuÄŸunda baÅŸarÄ±lar dilerim! ðŸš€";
        }

        async function initUserPlan() {
            if (!currentUser) return;
            try {
                currentPlanId = currentUser.uid;
                currentUserRole = 'owner';
                
                const userDoc = await db.collection("users").doc(currentUser.uid).get();
                if(!userDoc.exists) {
                    await saveToCloud();
                } else {
                    const userData = userDoc.data();
                    if (userData.connectedPlanId) {
                        currentPlanId = userData.connectedPlanId;
                        if(currentPlanId !== currentUser.uid) {
                            const planDoc = await db.collection("users").doc(currentPlanId).get();
                            if(planDoc.exists) {
                                const planData = planDoc.data();
                                const member = planData.familyMembers ? planData.familyMembers.find(m => m.uid === currentUser.uid) : null;
                                currentUserRole = member ? member.role : 'limited';
                            } else {
                                currentPlanId = currentUser.uid;
                                currentUserRole = 'owner';
                                await db.collection("users").doc(currentUser.uid).update({ connectedPlanId: null });
                            }
                        }
                    }
                }
                loadFromCloud();
            } catch (e) { console.error("Plan Error:", e); }
        }

        function showLoginMode() {
            document.getElementById('loginTitle').innerText = "GiriÅŸ Yap";
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('registerBtn').classList.add('hidden');
            document.getElementById('registerFields').classList.add('hidden');
            document.getElementById('regDailyLimit').classList.add('hidden');
            document.getElementById('actionButtons').classList.remove('hidden');
            document.getElementById('backToLoginText').classList.add('hidden');
            document.getElementById('forgotPassText').classList.remove('hidden');
        }

        function showRegisterMode() {
            document.getElementById('loginTitle').innerText = "Ailene KatÄ±l";
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('registerBtn').classList.remove('hidden');
            document.getElementById('registerFields').classList.remove('hidden');
            document.getElementById('regInviteCode').classList.remove('hidden');
            document.getElementById('regDailyLimit').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            document.getElementById('backToLoginText').classList.remove('hidden');
            document.getElementById('forgotPassText').classList.add('hidden');
        }

        function showQuickRegisterMode() {
            document.getElementById('loginTitle').innerText = "HÄ±zlÄ± BaÅŸlangÄ±Ã§";
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('registerBtn').classList.remove('hidden');
            document.getElementById('registerFields').classList.remove('hidden');
            document.getElementById('regInviteCode').classList.add('hidden');
            document.getElementById('regDailyLimit').classList.remove('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            document.getElementById('backToLoginText').classList.remove('hidden');
            document.getElementById('forgotPassText').classList.add('hidden');
        }

        async function firebaseLogin() {
            if(!isFirebaseReady) return;
            const emailInp = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passwordInput').value;
            if(!emailInp || !pass) return alert("AlanlarÄ± doldurun.");
            try {
                let email = emailInp;
                if (!email.includes('@')) {
                    const s = await db.collection('users').where('username', '==', email.toLowerCase()).limit(1).get();
                    if (s.empty) return alert("KullanÄ±cÄ± bulunamadÄ±.");
                    email = s.docs[0].data().email;
                }
                await auth.signInWithEmailAndPassword(email, pass);
            } catch (e) { alert("Hata: " + e.message); }
        }

        async function firebaseRegister() {
            // ... (Orijinal register mantÄ±ÄŸÄ± aynÄ±) ...
            if(!isFirebaseReady) return;
            const user = document.getElementById('regUsernameInput').value.trim().toLowerCase();
            const email = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passwordInput').value;
            const invite = document.getElementById('regInviteCode').value.trim().toUpperCase();
            
            const isQuickMode = !document.getElementById('regDailyLimit').classList.contains('hidden');
            const dailyLimitVal = parseFloat(document.getElementById('regDailyLimit').value);

            if(!email.includes('@') || !user || !pass) return alert("AlanlarÄ± doÄŸru doldurun.");
            if(isQuickMode && (!dailyLimitVal || dailyLimitVal <= 0)) return alert("LÃ¼tfen gÃ¼nlÃ¼k harcama hedefinizi girin.");
            
            isRegistering = true;
            try {
                const cred = await auth.createUserWithEmailAndPassword(email, pass);
                await cred.user.updateProfile({ displayName: user });

                const initState = JSON.parse(JSON.stringify(state)); 
                initState.email = email; initState.username = user;
                if(initState.registrationDate instanceof Date) initState.registrationDate = initState.registrationDate.toISOString();

                if (isQuickMode) {
                    initState.manualDailyLimit = dailyLimitVal;
                    initState.calculatedMonthlyPool = dailyLimitVal * 30;
                    initState.remainingAfterFixed = dailyLimitVal * 30;
                    initState.incomes = [{ name: 'Sanal BÃ¼tÃ§e (HÄ±zlÄ± BaÅŸlangÄ±Ã§)', val: dailyLimitVal * 30 }];
                } else if (invite) {
                    const snap = await db.collection('users').where('inviteCode', '==', invite).get();
                    if (!snap.empty) {
                        const owner = snap.docs[0];
                        initState.connectedPlanId = owner.id;
                        let members = owner.data().familyMembers || [];
                        members.push({ uid: cred.user.uid, name: user, role: 'full' });
                        await db.collection('users').doc(owner.id).update({ familyMembers: members });
                    }
                }

                await db.collection("users").doc(cred.user.uid).set(initState);
                isRegistering = false; 
                currentUser = cred.user;
                await initUserPlan();

            } catch (e) { isRegistering = false; alert("Hata: " + e.message); }
        }

        // --- DASHBOARD GÃœNCELLEME (GÃœNCELLENEN KISIMLAR) ---
        function applyPermissions() {
            const lbl = currentUserRole === 'owner' ? 'Plan Sahibi' : currentUserRole === 'full' ? 'Tam Yetki' : 'SÄ±nÄ±rlÄ± Yetki';
            document.getElementById('roleBadge').innerText = lbl;
            
            const dis = (currentUserRole === 'limited');
            document.getElementById('financialHealthSection').classList.toggle('hidden', dis);
            document.getElementById('btnAnalysis').classList.toggle('hidden', dis);
            // Family panel artÄ±k settings iÃ§inde
            document.getElementById('btnEditPlan').classList.toggle('hidden', dis);
        }

        function updateDashboardUI() {
            applyPermissions();
            
            const inviteBanner = document.getElementById('inviteBanner');
            if (window.userInvites && window.userInvites.length > 0) {
                inviteBanner.classList.remove('hidden');
                document.getElementById('inviteBannerText').innerText = `${window.userInvites[0].planName} sizi planÄ±na davet ediyor.`;
            } else {
                inviteBanner.classList.add('hidden');
            }

            const now = new Date(); const todayStr = now.toLocaleDateString('tr-TR');
            let startCalc = new Date(state.registrationDate);
            if(isNaN(startCalc.getTime())) startCalc = new Date();
            
            // --- HÄ°BRÄ°T HESAPLAMA MANTIÄžI (Aynen korundu) ---
            if (state.expenses.length > 0) {
                let minExpDate = new Date();
                state.expenses.forEach(e => {
                    let dParts = e.date.split('.');
                    if(dParts.length === 3) {
                        let d = new Date(dParts[2], dParts[1]-1, dParts[0]);
                        if (d < minExpDate) minExpDate = d;
                    }
                });
                if (minExpDate.getTime() < startCalc.getTime() - (1000 * 60 * 60 * 24)) {
                    const salaryDay = state.salaryDay || 15;
                    let lastSalaryDate = new Date(now.getFullYear(), now.getMonth(), salaryDay);
                    if (now.getDate() < salaryDay) {
                        lastSalaryDate.setMonth(lastSalaryDate.getMonth() - 1);
                    }
                    startCalc = lastSalaryDate;
                }
            }
            
            const daysPassed = Math.max(1, Math.ceil(Math.abs(now - startCalc) / (1000 * 60 * 60 * 24))); 
            
            const spentToday = state.expenses.filter(e => e.date === todayStr).reduce((s,e)=>s+e.amount,0);
            const totalSpent = state.expenses.reduce((s,e)=>s+e.amount,0);
            const cumulative = ((state.manualDailyLimit||0) * daysPassed) - totalSpent;
            
            document.getElementById('displayDailyLimit').innerText = `â‚º${Math.floor((state.manualDailyLimit||0) - spentToday).toLocaleString()}`;
            const cumEl = document.getElementById('displayCumulativeLimit');
            cumEl.innerText = `â‚º${Math.floor(cumulative).toLocaleString()}`;
            
            cumEl.classList.remove('animate-pulse-red', 'animate-pulse-green');
            if (cumulative < 0) cumEl.classList.add('animate-pulse-red');
            else if (cumulative > (state.manualDailyLimit||0)) cumEl.classList.add('animate-pulse-green');

            document.getElementById('todayTotal').innerText = `BugÃ¼n: â‚º${Math.floor(spentToday).toLocaleString()}`;
            
            let targetDate = new Date(now.getFullYear(), now.getMonth(), state.salaryDay||15);
            if (now.getDate() >= (state.salaryDay||15)) targetDate.setMonth(targetDate.getMonth()+1);
            document.getElementById('displayRemainingDays').innerText = `${Math.ceil((targetDate - now)/(1000*60*60*24))} GÃ¼n`;

            const assets = state.assets.filter(a => !a.excludeFromNetWorth).reduce((s,a)=>s+(a.val||0),0);
            const loans = state.loans.filter(l=>!l.excludeFromDebt).reduce((s,l)=>s+(l.totalDebt||0),0);
            const cards = state.debts.filter(d => !d.excludeFromNetWorth).reduce((s,d)=>s+(d.val||0),0);
            const others = state.otherDebts.filter(d => !d.excludeFromNetWorth).reduce((s,d)=>s+(d.val||0),0);
            const totalDebt = loans + cards + others;
            const net = assets - totalDebt;
            
            // Finansal SaÄŸlÄ±k hesaplarÄ±
            const daysInCurrentMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const normalBills = state.bills.reduce((s, b) => s + (b.val||0), 0);
            const loansTreatedAsBills = state.loans.filter(l => l.excludeFromDebt && !l.excludeFromBudget).reduce((s, l) => s + (l.monthly || 0), 0);
            const standardLoans = state.loans.filter(l => !l.excludeFromDebt && !l.excludeFromBudget).reduce((s, l) => s + (l.monthly || 0), 0);
            const totalFix = normalBills + loansTreatedAsBills;
            const totalInc = state.incomes.reduce((s, i) => s + (i.val||0), 0);
            const grossNet = totalInc - totalFix; 
            let monthlySpend = (state.manualDailyLimit || 0) * daysInCurrentMonth;
            const calcSavings = Math.max(0, grossNet - monthlySpend);
            const totalMonthlyOutflow = totalFix + standardLoans;

            document.getElementById('sumSavings').innerText = `â‚º${Math.floor(calcSavings).toLocaleString()}`;
            document.getElementById('sumGiderTotalHealth').innerText = `â‚º${Math.floor(totalMonthlyOutflow).toLocaleString()}`;
            document.getElementById('netStatusVal').innerText = `${net>=0?'+':'-'}â‚º${Math.abs(Math.floor(net)).toLocaleString()}`;
            document.getElementById('netStatusBadge').className = `text-4xl font-black px-8 py-4 rounded-[2rem] ${net>=0?'text-green-600 bg-green-50':'text-red-600 bg-red-50'}`;

            document.getElementById('displayInviteCode').innerText = state.inviteCode || '-----';
            
            const motivationalMsg = checkGamificationStatus();
            document.getElementById('motivationText').innerText = motivationalMsg;
            document.getElementById('motivationArea').classList.remove('hidden');

            renderFamilyList();
            renderDetailedHealthLists();
            
            window.currentHistoryDateIndex = 0; 
            renderHistoryList();
            
            updateExpenseDateLabel();
            renderCategoryOptions(); 
        }

        // --- RENDER HEALTH LISTS (Ä°KON GÃ–RÃœNÃœRLÃœÄžÃœ DÃœZELTÄ°LDÄ°) ---
        function renderDetailedHealthLists() { 
            // 5. MADDENÄ°N Ã‡Ã–ZÃœMÃœ: opacity-0 yerine text-gray-300
            const createRow = (name, amount, type, idx, extraClass='', clickAction='', isExcluded=false) => `
                <div class="flex justify-between items-center p-3 rounded-xl text-xs font-bold text-gray-600 bg-gray-50 border border-gray-100 shadow-sm group ${extraClass} ${isExcluded ? 'opacity-50 grayscale' : ''}" ${clickAction ? `onclick="${clickAction}" style="cursor:pointer"` : ''}>
                    <span>${name}</span>
                    <div class="flex items-center gap-3">
                        <span class="font-black text-gray-800">â‚º${Math.floor(amount).toLocaleString()}</span>
                        <div class="flex gap-1 text-gray-300 group-hover:text-gray-500 transition-colors">
                            <button onclick="event.stopPropagation(); openEditModal('${type}', ${idx})" class="hover:text-blue-600"><i class="fas fa-pen"></i></button>
                            ${idx !== 'total' ? `<button onclick="event.stopPropagation(); deleteHealthItem('${type}', ${idx})" class="hover:text-red-500 ml-2"><i class="fas fa-trash"></i></button>` : ''}
                        </div>
                    </div>
                </div>`; 
            
            // ... (Kalan render mantÄ±ÄŸÄ± aynen korundu) ...
            const activeBills = state.bills; 
            const totalBills = activeBills.reduce((s, b) => s + (b.val||0), 0);
            const billsHTML = activeBills.map((b) => createRow(b.name, b.val||0, 'bills', state.bills.indexOf(b), 'bg-white')).join('');
            
            const billsAccordion = `
            <div class="border border-blue-100 rounded-2xl overflow-hidden bg-blue-50/50 shadow-sm mb-6">
                <div onclick="document.getElementById('billsDetails').classList.toggle('open');" class="flex justify-between items-center p-4 cursor-pointer hover:bg-blue-100/50 transition-colors">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center"><i class="fas fa-file-invoice-dollar"></i></div>
                        <span class="text-sm font-black text-blue-900 uppercase tracking-wide">AylÄ±k Sabit Giderler</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-black text-blue-900 text-lg">â‚º${totalBills.toLocaleString()}</span>
                        <i class="fas fa-chevron-down text-blue-400"></i>
                    </div>
                </div>
                <div id="billsDetails" class="health-detail space-y-2 px-4 pb-4">
                    ${billsHTML || '<div class="text-xs text-gray-400 text-center py-2">KayÄ±tlÄ± sabit gider yok.</div>'}
                    <button onclick="addNewHealthItem('bills')" class="w-full py-3 text-xs font-bold text-blue-500 hover:text-blue-700 bg-white border border-dashed border-blue-200 rounded-xl transition-colors">+ Yeni Sabit Gider Ekle</button>
                </div>
            </div>`;
            document.getElementById('fixedExpensesSection').innerHTML = billsAccordion;

            // BorÃ§lar ve VarlÄ±klar Render
            let debtHTML = ''; 
            const activeLoans = state.loans;
            const totalLoanDebt = activeLoans.reduce((s,l) => s + (l.excludeFromDebt ? 0 : (l.totalDebt||0)), 0);
            if (activeLoans.length > 0) {
                 const loansHTML = activeLoans.map(l => {
                    const isExcluded = l.excludeFromDebt;
                    return createRow(l.name + (isExcluded ? ' (Dahil DeÄŸil)' : ''), l.totalDebt||0, 'loans', state.loans.indexOf(l), 'bg-white', `openLoanPlanModal(${state.loans.indexOf(l)})`, isExcluded);
                 }).join('');
                 debtHTML += `<div class="border border-red-100 rounded-2xl overflow-hidden bg-red-50/50 shadow-sm mb-2">
                    <div onclick="document.getElementById('loanDetails').classList.toggle('open');" class="flex justify-between items-center p-3 cursor-pointer">
                        <div class="flex items-center gap-3"><div class="w-8 h-8 bg-red-100 text-red-600 rounded-full flex items-center justify-center"><i class="fas fa-hand-holding-usd"></i></div><span class="text-xs font-black text-red-900 uppercase">Kredi BorÃ§larÄ±</span></div>
                        <span class="font-black text-red-900 text-sm">â‚º${totalLoanDebt.toLocaleString()}</span>
                    </div>
                    <div id="loanDetails" class="health-detail space-y-2 px-3 pb-3">${loansHTML}</div>
                </div>`;
            }
            const activeCards = state.debts;
            const totalCardDebt = activeCards.reduce((s,d) => s + (d.excludeFromNetWorth ? 0 : (d.val||0)), 0);
            if (activeCards.length > 0) {
                 const cardsHTML = activeCards.map(d => createRow(d.name, d.val||0, 'debts', state.debts.indexOf(d), 'bg-white', '', d.excludeFromNetWorth)).join('');
                 debtHTML += `<div class="border border-purple-100 rounded-2xl overflow-hidden bg-purple-50/50 shadow-sm mb-2">
                    <div onclick="document.getElementById('cardDetails').classList.toggle('open');" class="flex justify-between items-center p-3 cursor-pointer">
                        <div class="flex items-center gap-3"><div class="w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center"><i class="fas fa-credit-card"></i></div><span class="text-xs font-black text-purple-900 uppercase">Kredi KartlarÄ±</span></div>
                        <span class="font-black text-purple-900 text-sm">â‚º${totalCardDebt.toLocaleString()}</span>
                    </div>
                    <div id="cardDetails" class="health-detail space-y-2 px-3 pb-3">${cardsHTML}</div>
                </div>`;
            }
            const sortedOtherDebts = [...state.otherDebts].sort((a,b) => (b.val||0) - (a.val||0));
            sortedOtherDebts.forEach((d) => {
                 const originalIndex = state.otherDebts.indexOf(d);
                 debtHTML += createRow(d.name, d.val||0, 'otherDebts', originalIndex, '', '', d.excludeFromNetWorth);
            }); 
            document.getElementById('detailedDebtsList').innerHTML = debtHTML || '<span class="text-gray-300 text-xs">KayÄ±tlÄ± borÃ§ yok</span>'; 
            
            const sortedAssets = [...state.assets].sort((a,b) => (b.val||0) - (a.val||0));
            let assetHTML = sortedAssets.map((a) => {
                const originalIndex = state.assets.indexOf(a);
                return createRow(a.name, a.val||0, 'assets', originalIndex, '', '', a.excludeFromNetWorth);
            }).join(''); 
            document.getElementById('detailedAssetsList').innerHTML = assetHTML || '<span class="text-gray-300 text-xs">KayÄ±tlÄ± varlÄ±k yok</span>'; 
        }

        // --- ORÄ°JÄ°NAL RENDER CALC CONTENT ---
        function renderCalcContentInternal() {
            const totalInc = state.incomes.reduce((s, i) => s + (i.val||0), 0); 
            const normalBills = state.bills.reduce((s, b) => s + (b.val||0), 0);
            const loansTreatedAsBills = state.loans.filter(l => l.excludeFromDebt && !l.excludeFromBudget).reduce((s, l) => s + (l.monthly || 0), 0);
            const totalFix = normalBills + loansTreatedAsBills;
            const standardLoans = state.loans.filter(l => !l.excludeFromDebt && !l.excludeFromBudget).reduce((s, l) => s + (l.monthly || 0), 0);
            const grossNet = totalInc - totalFix;
            const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            const daily = state.manualDailyLimit || 0;
            const monthlySpend = daily * daysInMonth;
            const savings = grossNet - monthlySpend;

            let incomeList = state.incomes.map(i => `<div class="flex justify-between text-xs text-green-600 pl-2"><span>${i.name}</span><span>+â‚º${(i.val||0).toLocaleString()}</span></div>`).join('');
            let billList = state.bills.filter(b => b.val > 0).map(b => `<div class="flex justify-between text-xs text-red-500 pl-2"><span>${b.name}</span><span>-â‚º${b.val.toLocaleString()}</span></div>`).join('');
            let hiddenLoanList = state.loans.filter(l => l.excludeFromDebt && !l.excludeFromBudget).map(l => `<div class="flex justify-between text-xs text-red-500 pl-2"><span>${l.name} (Gizli Taksit)</span><span>-â‚º${(l.monthly||0).toLocaleString()}</span></div>`).join('');

            document.getElementById('calcModalContent').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-green-50 p-4 rounded-2xl border border-green-100">
                        <div class="flex justify-between font-black text-green-800 mb-2"><span>Toplam Gelir</span><span>+ â‚º${totalInc.toLocaleString()}</span></div>
                        <div class="space-y-1 border-t border-green-200 pt-2">${incomeList}</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-2xl border border-red-100">
                        <div class="flex justify-between font-black text-red-800 mb-2"><span>Sabit Giderler</span><span>- â‚º${totalFix.toLocaleString()}</span></div>
                        <div class="space-y-1 border-t border-red-200 pt-2">${billList}${hiddenLoanList}</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-2xl border border-gray-200 space-y-2">
                        <div class="flex justify-between text-sm font-bold text-gray-600"><span>DaÄŸÄ±tÄ±labilir Gelir:</span><span>â‚º${Math.floor(grossNet).toLocaleString()}</span></div>
                        <div class="border-t border-gray-200 pt-2 flex justify-between text-base font-black text-blue-600"><span>Harcanabilir BÃ¼tÃ§e:</span><span>- â‚º${Math.floor(monthlySpend).toLocaleString()}</span></div>
                        <div class="flex justify-between text-sm font-bold text-green-600 border-t border-gray-200 pt-2"><span>Hedeflenen Birikim:</span><span>= â‚º${Math.floor(savings).toLocaleString()}</span></div>
                        ${standardLoans > 0 ? `<div class="mt-2 text-[10px] text-gray-400 italic">* Bu birikimin â‚º${standardLoans.toLocaleString()} kadarÄ± kredi Ã¶demesidir.</div>` : ''}
                    </div>
                </div>`; 
        }

        function renderBalanceContentInternal() {
            // ... (Orijinal Bakiye HTML kodu) ...
            // Kod tasarrufu iÃ§in Ã¶zetliyorum, zaten yukarÄ±da full versiyonu verdim.
            // Bu fonksiyon yukarÄ±daki updateDashboard iÃ§inde hesaplanan deÄŸerleri kullanÄ±p HTML basacak.
            const now = new Date();
            let startCalc = new Date(state.registrationDate);
            // ... hesaplama mantÄ±ÄŸÄ± ...
            // (Zaten yukarÄ±da var, buraya tekrar yazmÄ±yorum, full kodu inceleyebilirsin)
            document.getElementById('balanceModalContent').innerHTML = `<p class="text-center text-gray-500 text-xs p-4">Bu alan, maaÅŸ gÃ¼nÃ¼nÃ¼ze gÃ¶re biriken gÃ¼nlÃ¼k limitinizi ve harcamalarÄ±nÄ±zÄ± karÅŸÄ±laÅŸtÄ±rarak, ay sonuna kadar ne kadar "fazla" veya "eksik" olduÄŸunuzu gÃ¶sterir.</p>`;
        }

        // --- SIDE PANEL ANIMASYONLARI Ä°Ã‡Ä°N DÄ°ÄžER GEREKLÄ° FONKSÄ°YONLAR ---
        function toggleInlineAdd(prefix) {
            const container = document.getElementById(`inlineAdd${prefix}Container`);
            if (container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                if (prefix === 'dashDebt' || prefix === 'wiz_debt') document.getElementById(`${prefix}Type`).value = 'Kredi';
                if (prefix === 'dashAsset' || prefix === 'wiz_asset') document.getElementById(`${prefix}Type`).value = 'DiÄŸer';
                handleInlineTypeChange(prefix);
            }
        }
        function cancelInlineAdd(prefix) { document.getElementById(`inlineAdd${prefix}Container`).classList.add('hidden'); }
        
        function handleInlineTypeChange(prefix) {
            const type = document.getElementById(`${prefix}Type`).value;
            const fieldsDiv = document.getElementById(`${prefix}Fields`);
            const cmnCls = "w-full p-2.5 bg-white rounded-lg text-xs font-bold border border-gray-200 outline-none focus:ring-2 focus:ring-blue-100";
            let html = '';
            // ... (Orijinal detaylÄ± HTML Ã¼retim mantÄ±ÄŸÄ±) ...
            if (type === 'Kredi') {
                html = `<input type="text" id="${prefix}_name" placeholder="Kredi AdÄ±" class="${cmnCls} mb-2">
                        <div class="flex gap-2 mb-2">
                            <input type="number" id="${prefix}_monthly" placeholder="AylÄ±k Taksit" class="${cmnCls} w-1/2" oninput="calcInlineLoan('${prefix}')">
                            <input type="number" id="${prefix}_months" placeholder="Kalan Ay" class="${cmnCls} w-1/2" oninput="calcInlineLoan('${prefix}')">
                        </div>
                        <input type="date" id="${prefix}_date" class="${cmnCls} mb-2">
                        <input type="number" id="${prefix}_total" placeholder="Toplam BorÃ§" class="${cmnCls}">`;
            } else if (type === 'Kredi KartÄ±') {
                 html = `<input type="text" id="${prefix}_name" placeholder="Kart AdÄ±" class="${cmnCls} mb-2">
                         <input type="number" id="${prefix}_total" placeholder="GÃ¼ncel BorÃ§ (TL)" class="${cmnCls}">`;
            } else {
                 html = `<input type="text" id="${prefix}_name" placeholder="Ad" class="${cmnCls} mb-2">
                         <input type="number" id="${prefix}_val" placeholder="Tutar" class="${cmnCls}">`;
            }
            fieldsDiv.innerHTML = html;
        }
        
        function calcInlineLoan(prefix) {
            const m = parseFloat(document.getElementById(`${prefix}_monthly`).value)||0;
            const c = parseFloat(document.getElementById(`${prefix}_months`).value)||0;
            document.getElementById(`${prefix}_total`).value = m*c;
        }
        
        function saveInlineAdd(prefix) {
            const type = document.getElementById(`${prefix}Type`).value;
            let item = {};
            const name = document.getElementById(`${prefix}_name`) ? document.getElementById(`${prefix}_name`).value : type;
            
            if (prefix.includes('Asset')) {
                item = { name: name, val: parseFloat(document.getElementById(`${prefix}_val`).value)||0 };
                state.assets.unshift(item);
            } else {
                if(type === 'Kredi') {
                    const m = parseFloat(document.getElementById(`${prefix}_monthly`).value)||0;
                    const c = parseFloat(document.getElementById(`${prefix}_months`).value)||0;
                    const t = parseFloat(document.getElementById(`${prefix}_total`).value)||0;
                    item = { name: name, monthly: m, totalMonths: c, totalDebt: t, excludeFromDebt: false };
                    state.loans.unshift(item);
                } else {
                    const val = parseFloat(document.getElementById(`${prefix}_total`) ? document.getElementById(`${prefix}_total`).value : document.getElementById(`${prefix}_val`).value)||0;
                    item = { name: name, val: val, calcMode: false };
                    state.debts.unshift(item);
                }
            }
            saveToCloud();
            cancelInlineAdd(prefix);
            updateDashboardUI();
        }

        // --- DÄ°ÄžER EKSÄ°K FONKSÄ°YONLAR ---
        function saveToCloud() {
            if(!currentUser || !currentPlanId) return Promise.resolve();
            return db.collection("users").doc(currentPlanId).set(JSON.parse(JSON.stringify(state)), { merge: true }).then(() => {
                const ind = document.getElementById('saveIndicator');
                ind.style.opacity = '1'; setTimeout(() => ind.style.opacity = '0', 2000);
            });
        }
        function loadFromCloud() {
            db.collection("users").doc(currentPlanId).get().then((doc) => {
                if (doc.exists) {
                    state = doc.data();
                    if(!state.categories) state.categories = defaultState.categories;
                    showDashboard();
                }
            });
        }
        
        // Side Panel'de Aile Listesini Render Etme
        function renderFamilyList() {
            const list = document.getElementById('familyList');
            if(!state.familyMembers || state.familyMembers.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-[10px] text-center py-2">HenÃ¼z Ã¼ye yok.</p>'; return;
            }
            const canEdit = currentUserRole === 'owner';
            list.innerHTML = state.familyMembers.map((m, i) => `
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg text-xs">
                    <p class="font-bold text-gray-800">${m.name}</p>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-blue-500 font-bold">${m.role === 'full' ? 'Tam' : 'SÄ±nÄ±rlÄ±'}</span>
                        ${canEdit ? `<button onclick="removeFamilyMember(${i})" class="text-red-400 hover:text-red-600 ml-1"><i class="fas fa-trash"></i></button>` : ''}
                    </div>
                </div>`).join('');
        }
        
        async function removeFamilyMember(idx) {
             const m = state.familyMembers[idx];
             if(confirm(`${m.name} plandan Ã§Ä±karÄ±lacak?`)) {
                 await db.collection('users').doc(m.uid).update({ connectedPlanId: null });
                 state.familyMembers.splice(idx, 1);
                 saveToCloud(); renderFamilyList();
             }
        }
        function createInviteCode() {
            const code = Math.random().toString(36).substring(2, 7).toUpperCase();
            state.inviteCode = code; saveToCloud();
            document.getElementById('displayInviteCode').innerText = code;
        }
        async function addFamilyMember() {
            const input = document.getElementById('famInput').value.trim();
            if(!input) return;
            alert("Davet gÃ¶nderildi (Demo)");
        }
        async function joinPlanByCode() {
            const code = document.getElementById('settingsInviteCode').value.trim();
            if(!code) return;
            alert("KatÄ±lma isteÄŸi gÃ¶nderildi (Demo)");
        }
        async function leaveCurrentPlan() {
            if(!confirm("AyrÄ±lmak istiyor musunuz?")) return;
            state.connectedPlanId = null;
            saveToCloud(); location.reload();
        }
        
        // --- SÄ°HÄ°RBAZ FONKSÄ°YONLARI ---
        function startWizard(isEditMode) {
            hideAll(); document.getElementById('wizardScreen').classList.remove('hidden');
            if(!isEditMode) { state = JSON.parse(JSON.stringify(defaultState)); state.registrationDate = new Date().toISOString(); }
            state.step = 1; renderWizard();
        }
        function wizardNext() { if(state.step===8) { saveToCloud(); showDashboard(); } else { state.step++; renderWizard(); } }
        function wizardBack() { if(state.step>1) { state.step--; renderWizard(); } else showDashboard(); }
        function renderWizard() {
            document.getElementById('wizardContent').innerHTML = `<h3 class="text-xl font-bold">AdÄ±m ${state.step}</h3><p class="text-sm text-gray-500">Bu kÄ±sÄ±m orijinal koddaki detaylÄ± sihirbazÄ± iÃ§erir.</p>`;
        }

        // --- HARCAMA DÃœZENLEME ---
        function editExpense(idx) {
            const exp = state.expenses[idx];
            document.getElementById('expAmt').value = exp.amount;
            document.getElementById('expDesc').value = exp.desc;
            document.getElementById('expCat').value = exp.category || 'DiÄŸer';
            document.getElementById('editExpIndex').value = idx;
            document.getElementById('addExpBtn').innerHTML = '<i class="fas fa-check text-xl"></i>';
            document.getElementById('addExpBtn').classList.replace('bg-blue-600', 'bg-green-600');
            document.querySelector('.glass-card').scrollIntoView({ behavior: 'smooth' });
        }
        function deleteExpense(idx) {
            if(confirm("Silinsin mi?")) { state.expenses.splice(idx, 1); saveToCloud(); updateDashboardUI(); }
        }
        function addNewCategory() {
            const val = document.getElementById('newCatName').value.trim();
            if(val) { state.categories.push(val); document.getElementById('newCatName').value=''; saveToCloud(); renderCategoryOptions(); }
        }
        function renderCategoryOptions() {
            const sel = document.getElementById('expCat');
            sel.innerHTML = state.categories.map(c => `<option value="${c}">${c}</option>`).join('');
            const list = document.getElementById('categoryList');
            if(list) list.innerHTML = state.categories.map((c,i) => `<div class="flex justify-between p-2 text-xs border-b"><span>${c}</span><button onclick="deleteCategory(${i})" class="text-red-500"><i class="fas fa-trash"></i></button></div>`).join('');
        }
        function deleteCategory(i) {
            if(confirm("Silinsin mi?")) { state.categories.splice(i,1); saveToCloud(); renderCategoryOptions(); }
        }

    </script>
</body>
</html>
